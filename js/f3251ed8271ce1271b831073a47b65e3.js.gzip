;// bundle: chat___0517bed497f254b930cc27d3625693aa_m
;// files: angular/angular.audio.js, ~/viewapp/pages/chat/chat.js, ~/viewapp/pages/chat/services/chatService.js, ~/viewapp/pages/chat/services/partyService.js, ~/viewapp/pages/chat/services/messageService.js, ~/viewapp/pages/chat/services/cookieService.js, ~/viewapp/pages/chat/services/chatUtilityService.js, ~/viewapp/pages/chat/services/chatHybridService.js, ~/viewapp/pages/chat/directives/chatDataDirective.js, ~/viewapp/pages/chat/controllers/chatController.js, ~/viewapp/pages/chat/controllers/dialogsController.js, ~/viewapp/pages/chat/directives/chatBarDirective.js, ~/viewapp/pages/chat/directives/lazyLoadDirective.js, ~/viewapp/pages/chat/directives/dialogDirective.js, ~/viewapp/pages/chat/directives/groupSelectDirective.js, ~/viewapp/pages/chat/directives/abuseReportDirective.js, ~/viewapp/pages/chat/directives/friendsSelectionDirective.js, ~/viewapp/pages/chat/controllers/dialogController.js, ~/viewapp/pages/chat/directives/dialogLazyLoadDirective.js, ~/viewapp/pages/chat/directives/dialogMinimizeDirective.js, ~/viewapp/pages/chat/directives/minimizeItemDirective.js, ~/viewapp/pages/chat/directives/chatSettingDirective.js, ~/viewapp/pages/chat/controllers/friendsController.js, ~/viewapp/pages/chat/directives/friendsLazyLoadDirective.js

;// angular/angular.audio.js
"use strict";angular.module("ngAudio",[]).directive("ngAudio",["$compile","$q","ngAudio",function(n,t,i){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:function(n,t,r,u){function e(){f=i.load(t.ngAudio,n),n.$audio=f,f.unbind()}var f;n.disablePreload||e();r.on("click",function(){n.clickPlay!==!1&&(n.disablePreload&&e(),f.audio.play(),f.volume=n.volume||f.volume,f.loop=n.loop,f.currentTime=n.start||0,u(function(){f.play()},5))});r.on("$destroy",function(){f.destroy()})}}}]).directive("ngAudioHover",["$compile","$q","ngAudio",function(n,t,i){return{restrict:"AEC",controller:function(n,t,r){var f=i.load(t.ngAudioHover,n);r.on("mouseover rollover hover",function(){f.audio.play(),f.volume=t.volumeHover||f.volume,f.loop=t.loop,f.currentTime=t.startHover||0});r.on("$destroy",function(){f.destroy()})}}}]).service("localAudioFindingService",["$q",function(n){this.find=function(t){var i=n.defer(),r=document.getElementById(t);return r?i.resolve(r):i.reject(t),i.promise}}]).service("remoteAudioFindingService",["$q",function(n){this.find=function(t){var r=n.defer(),i=new Audio;return i.addEventListener("error",function(){r.reject()}),i.addEventListener("loadstart",function(){r.resolve(i)}),setTimeout(function(){i.src=t},1),r.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(n,t,i){this.find=function(r){var u=n.defer();return r=r.replace("|","/"),t.find(r).then(u.resolve,function(){return i.find(r)}).then(u.resolve,u.reject),u.promise}}]).value("ngAudioGlobals",{muting:!1,songmuting:!1,performance:25,unlock:!0}).factory("NgAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","ngAudioGlobals",function(n,t,i,r,u){return function(r,f){function d(){o.play(),o.pause(),window.removeEventListener("click",d)}function rt(){w||(h&&i.cancel(h),k&&k(),s&&s(),w=!0)}function ft(){w||(s=b.$watch(function(){return{volume:e.volume,currentTime:e.currentTime,progress:e.progress,muting:e.muting,loop:e.loop,playbackRate:e.playbackRate}},function(n,t){n.currentTime!==t.currentTime&&e.setCurrentTime(n.currentTime),n.progress!==t.progress&&e.setProgress(n.progress),n.volume!==t.volume&&e.setVolume(n.volume),n.playbackRate!==t.playbackRate&&e.setPlaybackRate(n.playbackRate),l=n.loop,n.muting!==t.muting&&e.setMuting(n.muting)},!0))}function ut(){s&&s(),o&&(o.volume=p||u.isMuting?0:e.volume!==undefined?e.volume:1,y&&(o.play(),y=!1),nt&&(o.pause(),o.currentTime=0,nt=!1),v&&(o.pause(),v=!1),a&&(o.playbackRate=tt,a=!1),c&&(o.volume=c,c=undefined),it&&(e.currentTime=o.currentTime,e.duration=o.duration,e.remaining=o.duration-o.currentTime,e.progress=o.currentTime/o.duration,e.paused=o.paused,e.src=o.src,e.currentTime>=e.duration&&g.forEach(function(n){n(e)}),l&&e.currentTime>=e.duration&&(l!==!0&&(l--,e.loop--),e.setCurrentTime(0),e.play())),p||u.isMuting||(e.volume=o.volume),e.audio=o),ft()}var s,k,y=!1,v=!1,nt=!1,a=!1,tt=!1,c,l,p=!1,it=!0,w=!1,b=f||t,o,e=this,g,h;this.id=r,this.safeId=r.replace("/","|"),this.loop=0,this.unbind=function(){it=!1},this.play=function(){return y=!0,this},g=[],this.complete=function(n){g.push(n)},this.pause=function(){v=!0},this.restart=function(){nt=!0},this.stop=function(){this.restart()},this.setVolume=function(n){c=n},this.setPlaybackRate=function(n){tt=n,a=!0},this.setMuting=function(n){p=n},this.setProgress=function(n){o&&o.duration&&isFinite(n)&&(o.currentTime=o.duration*n)},this.setCurrentTime=function(n){o&&o.duration&&(o.currentTime=n)},this.destroy=rt,b.$on("$destroy",function(){rt()}),n.find(r).then(function(n){o=n,u.unlock&&(window.addEventListener("click",d),o.addEventListener("playing",function(){window.removeEventListener("click",d)})),o.addEventListener("canplay",function(){e.canPlay=!0})},function(n){e.error=!0,console.warn(n)}),h=i(ut,u.performance),k=b.$watch(function(){return u.performance},function(){i.cancel(h),h=i(ut,u.performance)})}}]).service("ngAudio",["NgAudioObject","ngAudioGlobals",function(n,t){this.play=function(t,i){var r=new n(t,i);return r.play(),r},this.load=function(t,i){return new n(t,i)},this.mute=function(){t.muting=!0},this.unmute=function(){t.muting=!1},this.toggleMute=function(){t.muting=!t.muting},this.setUnlock=function(n){t.unlock=n}}]).filter("trackTime",function(){return function(n){var t=Math.floor(n|0),f="",u=0,i=0,r=0;return t>3599?(u=Math.floor(t/3600),i=Math.floor((t-u*3600)/60),r=t-(i*60+u*3600),u.toString().length==1&&(u="0"+Math.floor(t/3600).toString()),i.toString().length==1&&(i="0"+Math.floor((t-u*3600)/60).toString()),r.toString().length==1&&(r="0"+(t-(i*60+u*3600)).toString()),f=u+":"+i+":"+r):t>59?(i=Math.floor(t/60),r=t-i*60,i.toString().length==1&&(i="0"+Math.floor(t/60).toString()),r.toString().length==1&&(r="0"+(t-i*60).toString()),f=i+":"+r):(r=t,r.toString().length==1&&(r="0"+t.toString()),f=t+"s"),typeof Number.isNaN=="function"&&Number.isNaN(f),f}});

;// ~/viewapp/pages/chat/chat.js
"use strict";var chat=angular.module("chat",["robloxApp.helpers","monospaced.elastic","ngAudio"]);

;// ~/viewapp/pages/chat/services/chatService.js
"use strict";chat.factory("chatService",["$http","$q","partyService","chatUtility","$log",function(n,t,i,r,u){var o={},s=100,h=100,f=function(i,r,f){var e=t.defer();return n({method:"GET",url:i.url,params:r,withCredentials:f,retryable:i.retryable}).success(function(n){e.resolve(n)}).error(function(n){u.debug("Error: unable to send "+i.url+" request."),e.reject(n)}),e.promise},e=function(i,r,f){var e=t.defer();return n({method:"POST",url:i.url,data:r,withCredentials:f,retryable:i.retryable}).success(function(n){e.resolve(n)}).error(function(n){u.debug("Error: unable to send "+i.url+" request."),e.reject(n)}),e.promise},a=function(t){var i="/thumbnail/avatar-headshots",r={userIds:t};return n({method:"GET",url:i,params:r,withCredentials:!0,retryable:!0})},v=function(t){var i="/presence/users",r={userIds:t};return n({method:"GET",url:i,params:r,withCredentials:!0,retryable:!0})},c=function(n){var u=[];angular.forEach(n,function(n){u.push(n.Id)});for(var t=0,i=s>=h?parseInt(s):parseInt(h),r=u.slice(t,i),f=[];r.length>0;)f.push(a(r)),f.push(v(r)),t++,r=u.slice(t*i,t*i+i);return f},y=function(n,t){for(var u=[],f=[],r=0,e=n.length,i;r<e;)u=u.concat(n[r].data),f=f.concat(n[r+1].data),r=r+2;for(i in t)u[i]&&(t[i].AvatarThumb=u[i]),f[i]&&(t[i].UserPresenceType=f[i].UserPresenceType),o[t[i].Id]=t[i],Roblox&&Roblox.Endpoints&&(o[t[i].Id].UserProfileLink=Roblox.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:t[i].Id},!0));return t},p=function(t){if(t.length===0)return[];var r={conversationIds:t};return n({method:"GET",url:i.apiSets.getPartiesForConversationsApi.url,params:r,withCredentials:!0,retryable:!0})},l=function(n,i){var r=[];return r=r.concat(p(n)),r=r.concat(c(i)),t.all(r).then(function(t){var r={parties:[],users:[]},u,f;return t&&t.length>0&&(u=n.length>0?t[0].data:[],f=t.slice(1),i=y(f,i),r={parties:u,users:i}),r})},w=function(n){var i=c(n);return t.all(i).then(function(t){for(var f=[],e=[],u=0,s=i.length,r;u<s;)f=f.concat(t[u].data),e=e.concat(t[u+1].data),u=u+2;for(r in n)f[r]&&(n[r].AvatarThumb=f[r]),e[r]&&(n[r].UserPresenceType=e[r].UserPresenceType),o[n[r].Id]=n[r];return n})};return{invitedParties:[],apiSets:{getFriendListUrl:{url:"/friends/list",retryable:!0},getUserAvatarUrl:{url:"/thumbnail/avatar-headshot",retryable:!0},getPresenceUserUrl:{url:"/presence/user",retryable:!0}},setParams:function(n){this.apiSets.markAsReadApi={url:n+"/v1.0/mark-as-read",retryable:!1},this.apiSets.sendMessageApi={url:n+"/v1.0/send-message",retryable:!1},this.apiSets.conversationsApi={url:n+"/v1.0/get-conversations",retryable:!0},this.apiSets.userConversationsApi={url:n+"/v1.0/get-user-conversations",retryable:!0},this.apiSets.unreadConversationsApi={url:n+"/v1.0/get-unread-conversations",retryable:!0},this.apiSets.getMessagesApi={url:n+"/v1.0/get-messages",retryable:!0},this.apiSets.multiGetLatestMessagesApi={url:n+"/v1.0/multi-get-latest-messages",retryable:!0},this.apiSets.unreadMessagesApi={url:n+"/v1.0/get-unread-messages",retryable:!0},this.apiSets.getUnreadConversationCountApi={url:n+"/v1.0/get-unread-conversation-count",retryable:!0},this.apiSets.startOneToOneConversationApi={url:n+"/v1.0/start-one-to-one-conversation",retryable:!0},this.apiSets.startGroupConversationApi={url:n+"/v1.0/start-group-conversation",retryable:!1},this.apiSets.addToConversationApi={url:n+"/v1.0/add-to-conversation",retryable:!0},this.apiSets.removeFromConversationApi={url:n+"/v1.0/remove-from-conversation",retryable:!0}},setAvatarHeadshotsMultigetLimit:function(n){s=n},setUserPresenceMultigetLimit:function(n){h=n},getFriendsDict:function(){return o},getUnreadConversationCount:function(){return f(this.apiSets.getUnreadConversationCountApi,null,!0)},getUnreadConversations:function(n,i,r){var e=this,o={pageNumber:n,pageSize:i};return f(this.apiSets.unreadConversationsApi,o,!0).then(function(n){var i=n;if(i.length>0){var f={},s=[],o=[];return i.forEach(function(n){s.push(n.Id),f[n.Id]=n,o.push(e.getMessages(n.Id,null,r).then(function(t){return{messages:t,conversationId:n.Id}}))}),t.all(o).then(function(n){var t=[];return angular.forEach(n,function(n){var e=n.conversationId,r=n.messages,u=f[e];u.ChatMessages=r,u.DisplayMessage=r.length>0?r[0]:[],t.push(u)}),t},function(){u.debug("------------ get messages request failed -------------")})}return null})},getUserConversations:function(f,e){var o={pageNumber:f,pageSize:e};return t.all([n({method:"GET",url:this.apiSets.userConversationsApi.url,params:o,retryable:this.apiSets.userConversationsApi.retryable,withCredentials:!0}),n({method:"GET",url:i.apiSets.getCurrentPartyApi.url,withCredentials:!0,retryable:i.apiSets.getCurrentPartyApi.retryable})]).then(function(n){var i=n[0].data?n[0].data:[],u=n[1].data?n[1].data:[],f=[],e=[],o=[],t={};return i.forEach(function(n){angular.forEach(n.ParticipantUsers,function(n){f.indexOf(n.Id)<0&&(f.push(n.Id),e.push(n))}),u&&u.ConversationId===n.Id&&(n.party=u,n.dialogType=r.dialogType.PARTY),n.dialogType||(n.dialogType=n.IsGroupChat?r.dialogType.GROUPCHAT:r.dialogType.CHAT),o.push(n.Id),t[n.Id]=n}),l(o,e).then(function(n){var u=n.parties;return u&&u.length>0&&u.forEach(function(n){t[n.ConversationId]&&!t[n.ConversationId].party&&(t[n.ConversationId].party=n,t[n.ConversationId].dialogType=r.dialogType.PENDINGPARTY)}),i},function(){return i})},function(){u.debug("------------ get user conversation request failed -------------")})},getUserInfo:function(i){var r={userId:i.Id};return t.all([n({method:"GET",url:this.apiSets.getUserAvatarUrl.url,params:r,retryable:this.apiSets.getUserAvatarUrl.retryable}),n({method:"GET",url:this.apiSets.getPresenceUserUrl.url,params:r,retryable:this.apiSets.getPresenceUserUrl.retryable})]).then(function(n){var t=n[0].data,r=n[1].data;return i.AvatarThumb=t,i.UserPresenceType=r.UserPresenceType,Roblox&&Roblox.Endpoints&&(i.UserProfileLink=Roblox.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:i.Id},!0)),i})},getUserPresence:function(n){var t={userId:n.Id};return f(this.apiSets.getPresenceUserUrl,t,!0)},getFriends:function(n,t,i){var r={userId:n,startIndex:t,pageSize:i};return f(this.apiSets.getFriendListUrl,r,!0).then(function(n){return angular.isDefined(n.Friends)&&n.Friends.length>0?w(n.Friends):null})},getConversations:function(n){var t={conversationIds:n};return f(this.apiSets.conversationsApi,t,!0)},addToConversation:function(n,t){var i={participantUserIds:n,conversationId:t};return e(this.apiSets.addToConversationApi,i,!0)},removeFromConversation:function(n,t){var i={participantUserId:n,conversationId:t};return e(this.apiSets.removeFromConversationApi,i,!0)},startOneToOneConversation:function(n){var t={participantUserId:n};return e(this.apiSets.startOneToOneConversationApi,t,!0)},startGroupConversation:function(n){var t={participantUserIds:n};return e(this.apiSets.startGroupConversationApi,t,!0)},getMessages:function(n,t,i){var r={conversationId:n,exclusiveStartMessageId:t,pageSize:i};return f(this.apiSets.getMessagesApi,r,!0)},multiGetLatestMessages:function(n,t){var i={conversationIds:n,pageSize:t};return f(this.apiSets.multiGetLatestMessagesApi,i,!0)},markAsRead:function(n,t){var i={conversationId:n,endMessageId:t};return e(this.apiSets.markAsReadApi,i,!0)},sendMessage:function(n,t){var i={conversationId:n,message:t};return e(this.apiSets.sendMessageApi,i,!0)}}}]);

;// ~/viewapp/pages/chat/services/partyService.js
"use strict";chat.factory("partyService",["chatHybridService","$http","$q","$document","$log",function(n,t,i,r,u){var e=function(n,r,f){var e=i.defer();return t({method:"GET",url:n.url,params:r,withCredentials:f,retryable:n.retryable}).success(function(n){e.resolve(n)}).error(function(t){u.debug("Error: unable to send "+n.url+" request."),e.reject(t)}),e.promise},f=function(n,r,f){var e=i.defer();return t({method:"POST",url:n.url,data:r,withCredentials:f,retryable:n.retryable}).success(function(n){e.resolve(n)}).error(function(t){u.debug("Error: unable to send "+n.url+" request."),e.reject(t)}),e.promise};return{apiSets:{getPlaceUrl:{url:"/thumbnail/place",retryable:!0}},setParams:function(n){this.apiSets.partyCreateApi={url:n+"/v1.0/party/create",retryable:!1},this.apiSets.partyInviteApi={url:n+"/v1.0/party/invite",retryable:!0},this.apiSets.partyLeaveApi={url:n+"/v1.0/party/leave",retryable:!0},this.apiSets.partyJoinApi={url:n+"/v1.0/party/join",retryable:!0},this.apiSets.getInvitedPartiesApi={url:n+"/v1.0/party/get-invites",retryable:!0},this.apiSets.getCurrentPartyApi={url:n+"/v1.0/party/get-current",retryable:!0},this.apiSets.removeFromPartyApi={url:n+"/v1.0/party/remove-from-party",retryable:!0},this.apiSets.getPartiesForConversationsApi={url:n+"/v1.0/party/get-parties-for-conversations",retryable:!0}},partyCreate:function(n,t){var i={invitedUserIds:t,conversationId:n};return f(this.apiSets.partyCreateApi,i,!0)},partyInvite:function(n,t){var i={invitedUserId:t,partyId:n};return f(this.apiSets.partyInviteApi,i,!0)},partyLeave:function(n){var t={partyId:n};return f(this.apiSets.partyLeaveApi,t,!0)},partyJoin:function(n){var t={partyId:n};return f(this.apiSets.partyJoinApi,t,!0)},getInvitedParties:function(n,t){var i={pageNumber:n,pageSize:t};return e(this.apiSets.getInvitedPartiesApi,i,!0)},getPartiesForConversations:function(n){var t={conversationIds:n};return e(this.apiSets.getPartiesForConversationsApi,t,!0)},getCurrentParty:function(){return e(this.apiSets.getCurrentPartyApi,null,!0)},removeFromParty:function(n,t){var i={partyId:n,userId:t};return f(this.apiSets.removeFromPartyApi,i,!0)},getPlace:function(n){var t={placeId:n};return e(this.apiSets.getPlaceUrl,t,!0)},joinGame:function(t,i){var u=t.party,f,e;u.GameId&&u.GamePlaceId&&(i?n.joinGame(u.GamePlaceId):(r.triggerHandler("Roblox.Chat.PartyInGame",{placeId:u.GamePlaceId}),f="PlaceLauncherStatusPanel",e=angular.element(document.querySelector("#"+f)),this.getPlace(u.GamePlaceId).then(function(n){t.placeThumbnail=n}),Roblox.GamePlayEvents&&Roblox.GamePlayEvents.SendGamePlayIntent("Party",u.GamePlaceId),e.data("is-protocol-handler-launch-enabled")==="True"?Roblox.GameLauncher.joinGameWithParty(u.GamePlaceId,u.Id,u.GameId):Roblox.Client.WaitForRoblox(function(){RobloxLaunch.RequestPlayWithParty(f,u.GamePlaceId,u.Id,u.GameId)})))}}}]);

;// ~/viewapp/pages/chat/services/messageService.js
"use strict";chat.factory("messageService",["chatService","chatUtility","$rootScope","$log",function(n,t,i,r){return{manipulateMessages:function(u,f,e){var l,h,s,o,c;if(f||(u.messagesDict={},u.unreadMessageIds=[]),angular.isUndefined(u.messagesDict)&&(u.messagesDict={}),angular.isUndefined(u.unreadMessageIds)&&(u.unreadMessageIds=[]),angular.isUndefined(u.ChatMessages)&&(u.ChatMessages=[]),f&&f.length>0){for(l=f.length,h=[],s=l-1;s>=0;s--)o=f[s],u.messagesDict[o.Id]||(o.Content=t.linkify(o.Content),u.messagesDict[o.Id]=o,u.ChatMessages.unshift(o),o.Read||u.unreadMessageIds.push(o.Id)),e&&!e[o.SenderUserId]&&h.indexOf(o.SenderUserId)<0&&(r.debug(" ----- new friend information for this message, trying to get now -----"+o.SenderUserId),c={Id:o.SenderUserId},h.push(o.SenderUserId),n.getUserInfo(c).then(function(n){n&&(e[c.Id]=n)},function(){r.debug(" ----- getUserInfo failed -----")}));u.unreadMessageIds.length>0&&i.$broadcast("Roblox.Chat.LoadUnreadConversationCount")}},appendMessages:function(n,r){var e,o,u,f;if(angular.isUndefined(n.unreadMessageIds)&&(n.unreadMessageIds=[]),n.ChatMessages&&n.ChatMessages.length!==0){if(n.ChatMessages){for(e={},u=0;u<n.ChatMessages.length;u++)if(!n.ChatMessages[u].isSystemMessage){e=n.ChatMessages[u];break}for(o=r.length,u=o-1;u>=0;u--)f=r[u],(angular.equals({},e)||f.Id>e.Id)&&(f.Content=t.linkify(f.Content),n.ChatMessages.unshift(f)),f.Read||(n.HasUnreadMessages=!0,n.unreadMessageIds.push(f.Id))}}else n.ChatMessages=r;n.DisplayMessage=r[0],n.unreadMessageIds.length>0&&i.$broadcast("Roblox.Chat.LoadUnreadConversationCount")},markMessagesAsRead:function(t){var u,f,e,r;t.ChatMessages&&t.unreadMessageIds&&(u=t.ChatMessages,f=u.length,t.unreadMessageIds.length>0&&t.unreadMessageIds[0]>=u[f-1].Id&&(e=t.unreadMessageIds.length,r=t.unreadMessageIds[e-1],angular.isUndefined(t.pendingUnreadMessageId)&&(t.pendingUnreadMessageId=[]),t.pendingUnreadMessageId.indexOf(r)<0&&(t.pendingUnreadMessageId.push(r),n.markAsRead(t.Id,r).then(function(n){n.Success&&(t.HasUnreadMessages=!1,t.unreadMessageIds=[],t.pendingUnreadMessageId.splice(r,1),i.$broadcast("Roblox.Chat.LoadUnreadConversationCount"))},function(){}))))},buildSystemMessage:function(n,i){var r=angular.copy(t.systemMessage),u;switch(n){case t.notificationType.iCreatedParty:r.Content="<a class='rbx-link-sm' href='"+t.party.gamesPageLink+"'>Find Games</a>"+t.party.createPartyText;break;case t.notificationType.iJoinedParty:r.Content=t.party.joinPartyText;break;case t.notificationType.partyUserJoined:u=i.newJoinedUsernames.length>0?i.newJoinedUsernames:"Member",r.Content=u+t.party.memberJoinText}angular.isUndefined(i.ChatMessages)&&(i.ChatMessages=[]),i.ChatMessages.unshift(r)},resetConversationUnreadStatus:function(t,r){r.length===0&&t.HasUnreadMessages&&n.markAsRead(t.Id,null).then(function(n){n.Success&&(t.HasUnreadMessages=!1,i.$broadcast("Roblox.Chat.LoadUnreadConversationCount"))},function(){})}}}]);

;// ~/viewapp/pages/chat/services/cookieService.js
"use strict";chat.factory("cookieService",["chatUtility","$log",function(){return{isCookieDefined:function(n){return angular.isDefined($.cookie(n))&&$.cookie(n)},updateCookie:function(n,t,i){$.cookie(n,JSON.stringify(t),i)},retrieveCookie:function(n){return this.isCookieDefined(n)?JSON.parse($.cookie(n)):[]},destroyCookie:function(n,t){$.cookie(n,null,t)}}}]);

;// ~/viewapp/pages/chat/services/chatUtilityService.js
"use strict";chat.factory("chatUtility",["$filter","$log",function(n){var i={FRIEND:-1,CHAT:0,GROUPCHAT:1,NEWGROUPCHAT:2,PARTY:3,NEWPARTY:4,PENDINGPARTY:5,ADDFRIENDS:6},r={INIT:0,OPEN:1,REPLACE:2,MINIMIZE:3,COLLAPSE:4,REMOVE:5,REFRESH:6},e={dialogType:i.NEWGROUPCHAT,layoutId:"newGroup",title:"Create Group"},u={MESSAGE:0,FRIENDSELECTION:1},o={PENDING:0,MEMBER:1,LEADER:2},f=angular.element("#chat-data-model").data("smallerchatenabled");return{chatLayout:{scrollbarClassName:"#chat-friend-list",collapsed:!0,pageInitializing:!1,pageDataLoading:!1,chatBarInitialized:!1,isChatLoading:!1,widthOfChatCollapsed:112,widthOfChat:f?256:262,widthOfDialog:f?250:300,spaceOfDialog:f?6:12,widthOfDialogMinimize:200,numberOfDialogOpen:0,defaultChatZIndex:1030,errorMaskEnable:!1,isFriendListEmpty:!1,isUserConversationEmpty:!1,chatLandingEnabled:!1,thresholdMobile:768,thresholdChatBarOpen:1738,resizing:!1,defaultTitleForMessage:" says ...",defaultTitleForPartyInvite:"Party invite from "},chatApiParams:{pageNumberOfUnreadConversations:1,pageSizeOfUnreadConversations:30,pageNumberOfPartyInvites:1,pageSizeOfPartyInvites:30,pageNumberOfConversations:1,pageSizeOfConversations:30,pageSizeOfDisplayMessages:1,pageSizeOfUnreadMessages:30,pageSizeOfGetMessages:30,startIndexOfFriendList:0,pageSizeOfFriendList:50,loadMoreUnreadConversations:!1,loadMoreConversations:!1,loadMoreFriends:!1,loadMoreInvitedParties:!1,loadMoreCurrentParty:!1},partyApiParams:{pageNumberOfPartyInvites:1,pageSizeOfPartyInvites:30,loadMoreInvitedParties:!1,loadMoreCurrentParty:!1},dialogParams:{loadMoreMessages:!0,sendingMessage:!1,sendMessageHasError:!1,loadMoreFriends:!1,startIndexOfFriendList:0,pageSizeOfFriendList:50,pageSizeOfGetMessages:30},dialogLayout:{focusMeEnabled:!0,hasFocus:!1,active:!1,isChatLoading:!1,collapsed:!1,isConfirmationOn:!1,isMembersOverloaded:!1,scrollToBottom:!1,IsdialogContainerVisible:!1,inviteBtnDisabled:!0,limitMemberDisplay:6,heightOfInput:40,maxHeightOfInput:92,limitCharacterCount:160,templateUrl:Roblox.ChatTemplates.DialogTemplate},userPresenceTypes:[{className:"",title:"Offline"},{className:"online",title:"Online"},{className:"ingame",title:"In Game"},{className:"instudio",title:"In Studio"}],dialogType:i,newGroup:e,scrollBarType:u,newParty:{dialogType:i.NEWPARTY,layoutId:"newParty",title:"Create Party",isCreated:!1,partyName:"Party : "},party:{partyName:"Party",partyInviteMsg:"PARTY INVITE!",isPartyExisted:!1,isPartyLeader:!1,partyLeaderTooltip:" is the party leader",partyMemberTooltip:" is in the party",pendingMemberTooltip:" is not in the party",memberJoinText:" joined the party",joinPartyText:"The party leader is finding a game to play.",createPartyText:" to play with your friends!"},memberStatus:o,dialogInitValue:{isUpdated:!0,updateStatus:r.INIT,markAsActive:!1,activeType:null,autoOpen:!1},dialogStatus:r,conversationInitStatus:{remove:!1},notificationType:{newMessage:"NewMessage",newMessageBySelf:"NewMessageBySelf",newConversation:"NewConversation",addedToConversation:"AddedToConversation",participantAdded:"ParticipantAdded",participantLeft:"ParticipantLeft",invitedToParty:"InvitedToParty",partyUserJoined:"PartyUserJoined",partyUserLeft:"PartyUserLeft",iLeftParty:"ILeftParty",partyJoinedGame:"PartyJoinedGame",partyLeftGame:"PartyLeftGame",partyDeleted:"PartyDeleted",iCreatedParty:"ICreatedParty",iJoinedParty:"IJoinedParty",friendshipDestroyed:"FriendshipDestroyed",friendshipCreated:"FriendshipCreated",presenceOffline:"UserOffline",presenceOnline:"UserOnline"},systemMessage:{isSystemMessage:!0},deviceType:{COMPUTER:"Computer",PHONE:"Phone",TABLET:"Tablet"},cookies:{dialogIdList:"dialogIdList",dialogDict:"dialogDict",dialogsLayout:"dialogsLayout",chatBarLayout:"chatBarLayout"},activeType:{NEWMESSAGE:"New message",PARTYINVITE:"Party Invite"},buildScrollbar:function(n){var t=angular.element(document.querySelector(n));t.mCustomScrollbar({autoHideScrollbar:!1,autoExpandScrollbar:!1,contentTouchScroll:300,documentTouchScroll:!1,mouseWheel:{preventDefault:!0},advanced:{autoScrollOnFocus:!1}})},updateScrollbar:function(n){var t=angular.element(document.querySelector(n));t.mCustomScrollbar("update")},removeParty:function(n,t){var u=t.layoutId,f,e;t.party?(t.dialogType=i.PENDINGPARTY,f=t.party.Id,t.party.LeaderUser.Id===n.userId&&t.party.MemberUsers.length===1&&t.party.MemberUsers[0].Id===n.userId&&(t.party=null,t.placeThumbnail=null,t.dialogType=t.IsGroupChat?i.GROUPCHAT:i.CHAT),angular.isDefined(n.partyIds)&&(e=n.partyIds.indexOf(f),e>-1&&n.partyIds.splice(e,1)),angular.isDefined(n.partiesDict)&&delete n.partiesDict[f]):t.dialogType=t.IsGroupChat?i.GROUPCHAT:i.CHAT,n.dialogDict[u]&&n.dialogIdList.indexOf(u)>-1&&(n.dialogDict[u].isUpdated=!0,n.dialogDict[u].updateStatus=r.REFRESH)},deleteParty:function(n,t,i){if(n.partyIds.length>0){var r=angular.copy(n.partyIds),u=this;r.forEach(function(r){if(r===i){var f=n.partiesDict[r].layoutId,e=t[f];u.removeParty(n,e)}})}},cleanPartyList:function(n,t,i){if(n.partyIds.length>0){var r=angular.copy(n.partyIds),u=this;r.forEach(function(r){if(r!==i){var f=n.partiesDict[r].layoutId,e=t[f];u.removeParty(n,e)}})}},htmlEntities:function(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},linkify:function(n){return angular.isDefined(Roblox)&&angular.isDefined(Roblox.Linkify)&&typeof Roblox.Linkify.String=="function"?Roblox.Linkify.String(n):n},sortFriendList:function(t,i){var f=n("orderBy"),r=[],u=[],e=[];return t.friendIds.forEach(function(n){var i=t.friendsDict[n];i.UserPresenceType>0?r.push(i):u.push(i),e.push(n)}),i.forEach(function(n){e.indexOf(n.Id)<0&&(n.UserPresenceType>0?r.push(n):u.push(n))}),r=f(r,"+Username"),u=f(u,"+Username"),i=r.concat(u)},getScrollBarSelector:function(n,t){var i=n.layoutId;angular.isUndefined(t)&&(t=n.scrollBarType);switch(t){case u.FRIENDSELECTION:return"#scrollbar_friend_"+n.dialogType+"_"+i;case u.MESSAGE:default:return"#scrollbar_"+n.dialogType+"_"+i}}}}]);

;// ~/viewapp/pages/chat/services/chatHybridService.js
"use strict";chat.factory("chatHybridService",["$log",function(){return{setNewMessageNotification:function(n,t){angular.isUndefined(t)&&(t=function(){}),Roblox.Hybrid.Chat.newMessageNotification(n,t)},joinGame:function(n,t){angular.isUndefined(t)&&(t=function(){}),Roblox.Hybrid.Game.launchPartyForPlaceId(n,t)},getTopBarHeight:function(){Roblox.Hybrid.Chat.getTopBarHeight(function(n,t){return t.topBarHeight})}}}]);

;// ~/viewapp/pages/chat/directives/chatDataDirective.js
"use strict";chat.directive("chatData",["chatService","partyService","ngAudio","chatUtility",function(n,t,i,r){return{restrict:"A",scope:{chatViewModel:"=",chatLibrary:"="},link:function(u,f,e){var o="https://chat."+e.domain,s="https://notifications."+e.domain;u.chatViewModel={chatDomain:o,friendsDict:{},friendsHasConversation:[],chatUserDict:{},signalRDomain:s,signalRHubName:"userNotificationHub",convIdsForInvitedParties:[],invitedParties:{}},u.chatLibrary.domain=e.domain,u.chatLibrary.gamesPageLink=e.gamespagelink,r.party.gamesPageLink=e.gamespagelink,u.chatLibrary.userId=parseInt(e.userid),u.chatLibrary.spinner=e.spinner,u.chatLibrary.deviceType=e.devicetype,u.chatLibrary.inApp=e.inapp==="true",u.chatLibrary.tabletInApp=e.devicetype===r.deviceType.TABLET&&e.inapp==="true",u.chatLibrary.chatInPhone=e.devicetype===r.deviceType.PHONE&&e.inapp==="true",u.chatLibrary.maxNumberOfPartyMembers=e.numberofmembersforpartychrome,u.chatLibrary.quotaOfPartyMembers=e.numberofmembersforpartychrome-1,u.chatLibrary.intervalOfChangeTitleForPartyChrome=e.intervalofchangetitleforpartychrome,u.chatLibrary.audio=i.load(Roblox.Chat.SoundFile),u.chatLibrary.cookieOption={domain:e.domain,path:"/",expires:null},u.chatLibrary.dialogLocalStorageName="dialogLibrary_"+e.domain,u.chatLibrary.cleanPartyFromConversationEnabled=e.cleanpartyfromconversationenabled==="true",n.setParams(o),n.setAvatarHeadshotsMultigetLimit(e.avatarheadshotsmultigetlimit),n.setUserPresenceMultigetLimit(e.userpresencemultigetlimit),t.setParams(o)}}}]);

;// ~/viewapp/pages/chat/controllers/chatController.js
"use strict";chat.controller("chatController",["$scope","chatService","partyService","messageService","chatUtility","cookieService","localStorageService","chatHybridService","$interval","$window","$document","$filter","$log",function(n,t,i,r,u,f,e,o,s,h,c,l,a){var y=function(t){n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.REFRESH)},st=function(){var t=h.innerWidth,i=t-u.chatLayout.widthOfChat-u.chatLayout.widthOfDialogMinimize,r=u.chatLayout.widthOfDialog+u.chatLayout.spaceOfDialog;n.chatLibrary.chatLayout.availableNumberOfDialogs=Math.floor(i/r),n.chatLibrary.chatLayout.numberOfDialogs=n.chatLibrary.dialogIdList.length,a.debug(" -------------numberOfDialogs = -------------- "+n.chatLibrary.chatLayout.numberOfDialogs),a.debug(" -------------availableNumberOfDialogs = -------------- "+n.chatLibrary.chatLayout.availableNumberOfDialogs)},ot=function(){var t=h.innerWidth;return n.chatLibrary.chatLayout.numberOfDialogs>=n.chatLibrary.chatLayout.availableNumberOfDialogs&&t>u.chatLayout.thresholdMobile},gt=function(){var t=h.innerWidth;return n.chatLibrary.chatLayout.numberOfDialogs<n.chatLibrary.chatLayout.availableNumberOfDialogs&&t>u.chatLayout.thresholdMobile},g=function(t,i){var r,f,e;if(n.chatLibrary.deviceType===u.deviceType.PHONE&&(n.chatLibrary.dialogIdList.forEach(function(t){n.closeDialog(t)}),n.chatLibrary.dialogIdList=[]),st(),ot()&&n.chatLibrary.deviceType===u.deviceType.COMPUTER)while(n.chatLibrary.dialogIdList.length>=n.chatLibrary.chatLayout.availableNumberOfDialogs){if(r=n.chatLibrary.dialogIdList.pop(),angular.isUndefined(r))break;n.chatLibrary.dialogDict[r].isUpdated=!0,n.chatLibrary.dialogDict[r].updateStatus=u.dialogStatus.MINIMIZE,f=n.chatLibrary.minimizedDialogIdList.indexOf(t),f>-1&&(n.chatLibrary.minimizedDialogIdList.splice(f,1),delete n.chatLibrary.minimizedDialogData[t])}n.chatLibrary.dialogIdList.push(t),e=angular.copy(u.dialogInitValue),angular.isDefined(i)&&i&&(e.autoOpen=!0),n.chatLibrary.dialogDict[t]=e},tt=function(t,i){n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].markAsActive=!0,n.chatLibrary.dialogDict[t].activeType=i)},p=function(t){n.chatLibrary.dialogDict[t.layoutId]&&y(t.layoutId),n.chatLibrary.deviceType===u.deviceType.COMPUTER&&!n.chatLibrary.dialogDict[t.layoutId]&&(t.dialogType===u.dialogType.PENDINGPARTY||t.DisplayMessage&&t.DisplayMessage.Content)&&n.launchDialog(t.layoutId,!0)},ct=function(t,i){n.chatLibrary.partyIds.indexOf(t)<0&&(n.chatLibrary.partyIds.push(t),n.chatLibrary.partiesDict[t]={conversationId:i.Id,layoutId:i.layoutId}),n.chatLibrary.partyIds.length>0&&(n.chatLibrary.party.isPartyExisted=!0)},pt=function(i){i.length>0&&t.multiGetLatestMessages(i,u.chatApiParams.pageSizeOfDisplayMessages).then(function(t){angular.forEach(t,function(t){var i=t.ChatMessages,f=i.length>0?i[0]:{},u;n.chatLibrary.conversationsDict[t.ConversationId]&&(u=n.chatLibrary.conversationsDict[t.ConversationId].layoutId,n.chatUserDict[u].DisplayMessage=f,r.resetConversationUnreadStatus(n.chatUserDict[u],i))})},function(){a.debug("----- multiGetLatestMessages request is failed ! ------")})},d=function(){(n.chatLibrary.chatLayout.collapsed||n.chatLibrary.inApp)&&t.getUnreadConversationCount().then(function(t){n.chatViewModel.conversationCount=t,n.chatLibrary.inApp&&o.setNewMessageNotification(t)},function(){a.debug("----- getUnreadConversationCount request is failed ! ------")})},it=function(i){var r=[];r.push(i),t.getConversations(r).then(function(t){n.buildChatUserListByUnreadConversations(t)},function(){a.debug(" -------- fetchConversation request failed ------ ")})},rt=function(i,f){var o=n.getLayoutId(i,u.dialogType.CHAT),e;angular.isUndefined(n.chatUserDict[o])?it(i):(e=n.chatUserDict[o],t.getMessages(i,null,u.dialogParams.pageSizeOfGetMessages).then(function(t){t&&t.length>0&&(r.appendMessages(e,t),n.updateChatViewModel(e,!0),p(e),f||tt(e.layoutId,u.activeType.NEWMESSAGE))},function(){}))},ut=function(t,i,r,f){t.party=i,t.dialogType=!t.IsGroupChat&&r?u.dialogType.CHAT:u.dialogType.PENDINGPARTY,t.incomingPartyInvite=!0,t.pendingPartyMsg=u.party.partyInviteMsg,n.getUserInfoForConversation(t);var e=t.layoutId;n.chatLibrary.dialogDict[e]&&y(e),f===i.Id&&(p(t),r||tt(t.layoutId,u.activeType.PARTYINVITE)),n.chatLibrary.pendingPartiesDict[i.Id]={conversationId:t.Id,layoutId:t.layoutId}},k=function(r,f){i.getInvitedParties(n.partyApiParams.pageNumberOfPartyInvites,n.partyApiParams.pageSizeOfPartyInvites).then(function(i){var s=n.chatUserDict,e=i,o=!1;e.length>0?(e.forEach(function(t){t&&(angular.equals({},s)||angular.forEach(s,function(n){n.isConversation&&t.ConversationId===n.Id&&(ut(n,t,f,r),o=!0)}),o||(n.convIdsForInvitedParties.push(t.ConversationId),n.invitedParties[t.ConversationId]=t))}),e.length===n.partyApiParams.pageSizeOfPartyInvites&&(n.partyApiParams.pageNumberOfPartyInvites++,n.partyApiParams.loadMoreInvitedParties=!0,k(r,f)),o||(t.getConversations(n.convIdsForInvitedParties).then(function(t){var i=[];t.forEach(function(t){var e=n.invitedParties[t.Id],s=n.chatLibrary.userId===e.LeaderUser.Id?u.dialogType.PARTY:u.dialogType.PENDINGPARTY,o=n.getLayoutId(t.Id,u.dialogType.PENDINGPARTY);n.chatUserDict[o]?(ut(n.chatUserDict[o],e,f,r),n.updateChatViewModel(n.chatUserDict[o],!0)):(t.party=e,t.dialogType=s,i.push(t))}),i.length>0&&n.buildChatUserListByConversations(i,!0),n.convIdsForInvitedParties=[],n.invitedParties={}}),n.partyApiParams.loadMoreInvitedParties=!1)):n.partyApiParams.loadMoreInvitedParties=!1})},et=function(n){n.party=null,n.placeThumbnail=null,n.dialogType=n.IsGroupChat?u.dialogType.GROUPCHAT:u.dialogType.CHAT,y(n.layoutId)},dt=function(t){var i=!1,r,f,e;u.deleteParty(n.chatLibrary,n.chatUserDict,t),n.chatLibrary.pendingPartiesDict[t]&&(i=!0,r=n.chatLibrary.pendingPartiesDict[t].layoutId,f=n.chatUserDict[r],et(f)),n.chatLibrary.cleanPartyFromConversationEnabled&&!i&&(e=n.chatUserDict,angular.forEach(e,function(n){n.isConversation&&n.party&&n.party.Id===t&&(i=!0,et(n))}))},kt=function(n,t){var i,r;if(angular.isDefined(n.party))for(n.newJoinedUsernames="",i=0;i<t.MemberUsers.length;i++)if(r=t.MemberUsers[i],!n.membersDict[r.Id]||n.membersDict[r.Id].memberStatus===u.memberStatus.PENDING){n.newJoinedUsernames=r.Name;break}n.party=t},w=function(t){i.getCurrentParty().then(function(f){if(f){u.cleanPartyList(n.chatLibrary,n.chatUserDict,f.Id);var s=f.ConversationId,o=n.getLayoutId(s,u.dialogType.PARTY),e=n.chatUserDict[o];n.chatLibrary.partiesDict[f.Id]||ct(f.Id,e),e.dialogType=u.dialogType.PARTY,kt(e,f),e.party.LeaderUser.Id===n.chatLibrary.userId&&(n.chatLibrary.party.isPartyLeader=!0),e.party.GamePlaceId&&e.party.LeaderUser.Id!==n.chatLibrary.userId&&i.joinGame(e,n.chatLibrary.inApp),e.party.GamePlaceId&&!e.placeThumbnail&&i.getPlace(e.party.GamePlaceId).then(function(n){e.placeThumbnail=n}),y(o),n.getUserInfoForConversation(e),n.updateChatViewModel(e,!0),angular.isDefined(t)&&r.buildSystemMessage(t,e)}else u.cleanPartyList(n.chatLibrary,n.chatUserDict,null)},function(){a.debug(" -------- getCurrentParty request failed ------ ")})},bt=function(){angular.isDefined(n.preSetChatLibrary)&&angular.isDefined(n.preSetChatLibrary.dialogIdList)&&(n.chatLibrary.dialogIdList=n.preSetChatLibrary.dialogIdList,angular.forEach(n.preSetChatLibrary.dialogDict,function(t,i){t.isUpdated||(t.isUpdated=!0),i===u.newGroup.layoutId&&(n.chatUserDict[u.newGroup.layoutId]=n.newGroup),n.chatLibrary.dialogDict[i]=t,n.chatLibrary.dialogsLayout[i]=n.preSetChatLibrary.dialogsLayout[i]}))},ht=function(){return h.innerWidth>=u.chatLayout.thresholdChatBarOpen&&!n.chatLibrary.isTakeOverOn&&!angular.element(document.querySelector("#GamesPageLeftColumn")).length},wt=function(){if(!n.chatLibrary.inApp){var t={collapsed:n.chatLibrary.chatLayout.collapsed};f.updateCookie(u.cookies.chatBarLayout,t,n.chatLibrary.cookieOption)}},ft=function(){n.chatUserDict={},n.dialogType=angular.copy(u.dialogType),n.deviceType=angular.copy(u.deviceType),n.memberStatus=angular.copy(u.memberStatus),n.userPresenceTypes=angular.copy(u.userPresenceTypes),n.newGroup=angular.copy(u.newGroup),n.newParty=angular.copy(u.newParty),n.party=angular.copy(u.party),n.selectedFriendIds=[],n.chatLibrary={partyIds:[],partiesDict:{},pendingPartiesDict:{},conversationsDict:{},userConversationsDict:{},friendIds:[],friendLayoutIds:[],friendsDict:{},chatLayout:angular.copy(u.chatLayout),chatLayoutIds:[],layoutIdList:[],dialogIdList:[],dialogDict:{},dialogsLayout:{},party:u.party,minimizedDialogIdList:[],minimizedDialogData:{},isTakeOverOn:angular.element(document.querySelector("#wrap")).data("gutter-ads-enabled"),currentTabTitle:h.document.title},n.convIdsForInvitedParties=[],n.invitedParties={}},lt=function(){n.preSetChatLibrary={},n.chatLibrary.inApp||(f.isCookieDefined(u.cookies.dialogDict)&&(n.preSetChatLibrary={dialogIdList:f.isCookieDefined(u.cookies.dialogIdList)?f.retrieveCookie(u.cookies.dialogIdList):[],dialogDict:f.retrieveCookie(u.cookies.dialogDict),dialogsLayout:f.retrieveCookie(u.cookies.dialogsLayout)}),f.isCookieDefined(u.cookies.chatBarLayout)&&(n.preSetChatLibrary.chatBarLayout=f.retrieveCookie(u.cookies.chatBarLayout))),n.chatApiParams=angular.copy(u.chatApiParams),n.partyApiParams=angular.copy(u.partyApiParams)},ni=function(){n.chatLibrary.inApp?(n.chatLibrary.chatLayout.collapsed=!1,n.chatLibrary.chatLayout.chatBarInitialized=!0):n.chatLibrary.inApp||n.chatLibrary.chatLayout.chatBarInitialized||(ht()&&!n.preSetChatLibrary.chatBarLayout?n.chatLibrary.chatLayout.collapsed=!1:n.preSetChatLibrary.chatBarLayout?n.chatLibrary.chatLayout.collapsed=n.preSetChatLibrary.chatBarLayout.collapsed:ht()||(n.chatLibrary.chatLayout.collapsed=!0),n.chatLibrary.chatLayout.chatBarInitialized=!0)},yt=function(t){if(n.chatLibrary.friendIds.indexOf(t.Id)<0&&n.chatLibrary.friendIds.push(t.Id),n.chatLibrary.friendsDict[t.Id]||(n.chatLibrary.friendsDict[t.Id]=angular.copy(t)),n.chatViewModel.friendsHasConversation.indexOf(t.Id)<0){var i=n.getLayoutId(t.Id,u.dialogType.FRIEND);t.layoutId=i,t.isConversation=!1,t.dialogType=u.dialogType.FRIEND,n.chatLibrary.friendLayoutIds.indexOf(i)<0&&n.chatLibrary.friendLayoutIds.push(i),n.updateChatViewModel(t,!1),n.chatLibrary.chatLayout.chatLandingEnabled&&(n.chatLibrary.chatLayout.chatLandingEnabled=!1)}},v=function(t,i){var r=n.chatLibrary.layoutIdList.indexOf(t);i&&r>-1?n.chatLibrary.layoutIdList.splice(r,1):!i&&r<0&&n.chatLibrary.layoutIdList.push(t)},vt=function(t){var i=null,f,e,r,o;i=n.chatLibrary.userConversationsDict[t]?n.chatLibrary.userConversationsDict[t]:n.getLayoutId(t,u.dialogType.FRIEND),f=n.chatUserDict[i],f.isConversation?(e=n.chatUserDict[i].Id,n.chatLibrary.conversationsDict[e].remove=!0):(r=n.chatLibrary.chatLayoutIds.indexOf(i),r>-1&&(n.chatLibrary.chatLayoutIds.splice(r,1),delete n.chatUserDict[i],v(i,!0))),n.chatViewModel.friendsHasConversation.indexOf(t)>-1&&(o=n.chatViewModel.friendsHasConversation.indexOf(t),n.chatViewModel.friendsHasConversation.splice(o,1)),n.chatLibrary.chatLayoutIds.indexOf(i)>-1&&n.closeDialog(i),n.chatLibrary.chatLayoutIds.length===0&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)},b=function(){n.buildChatUserListByFriends(n.chatApiParams.startIndexOfFriendList,n.chatApiParams.pageSizeOfFriendList).then(function(t){n.chatApiParams.startIndexOfFriendList!==0||t&&t.length!==0||(n.chatLibrary.chatLayout.chatLandingEnabled=!0),t&&t.length>0&&n.filterFriends(t),t&&t.length===n.chatApiParams.pageSizeOfFriendList?(n.chatApiParams.startIndexOfFriendList=+n.chatApiParams.startIndexOfFriendList+n.chatApiParams.pageSizeOfFriendList,b()):(n.chatApiParams.startIndexOfFriendList=0,n.chatApiParams.loadMoreFriends=!1)})},at=function(){var i=t.getFriendsDict();angular.forEach(i,function(t){n.chatLibrary.friendsDict[t.Id]=t})},nt=function(){n.chatUserDict&&n.chatLibrary||ft(),d(),t.getUserConversations(n.chatApiParams.pageNumberOfConversations,n.chatApiParams.pageSizeOfConversations).then(function(t){t&&t.length>0&&(at(),n.buildChatUserListByConversations(t,!1),n.chatApiParams.pageNumberOfConversations++,n.chatApiParams.pageNumberOfPartyInvites++,bt()),!t||t.length<n.chatApiParams.pageSizeOfConversations?(n.chatApiParams.pageNumberOfConversations=1,b(),t.length===0&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)):n.chatApiParams.loadMoreConversations=!0,u.buildScrollbar(u.chatLayout.scrollbarClassName),n.chatLibrary.chatLayout.pageDataLoading&&(n.chatLibrary.chatLayout.pageDataLoading=!1)},function(){a.debug("--getConversations-error---")})},ti=function(){if(angular.isDefined(Roblox.UserNotifications)){Roblox.UserNotifications.onConnected(n.handleSignalRSuccess);Roblox.UserNotifications.onDisconnected(n.handleSignalRError);Roblox.UserNotifications.subscribe("ChatNotifications",function(n){a.debug("--------- this is ChatNotifications subscription -----------"+n.Type);switch(n.Type){case u.notificationType.newMessage:rt(n.ConversationId);break;case u.notificationType.newMessageBySelf:rt(n.ConversationId,!0);break;case u.notificationType.newConversation:case u.notificationType.addedToConversation:case u.notificationType.participantAdded:case u.notificationType.participantLeft:it(n.ConversationId)}}),Roblox.UserNotifications.subscribe("PartyNotifications",function(t){a.debug("--------- this is PartyNotifications subscription -----------"+t.Type);switch(t.Type){case u.notificationType.invitedToParty:n.partyApiParams.loadMoreInvitedParties||k(t.PartyId);break;case u.notificationType.iLeftParty:n.partyApiParams.loadMoreInvitedParties||k(t.PartyId,!0);break;case u.notificationType.partyUserLeft:case u.notificationType.partyLeftGame:n.partyApiParams.loadMoreCurrentParty||w();break;case u.notificationType.partyJoinedGame:n.partyApiParams.loadMoreCurrentParty||w();break;case u.notificationType.partyDeleted:dt(t.PartyId);break;case u.notificationType.partyUserJoined:case u.notificationType.iCreatedParty:case u.notificationType.iJoinedParty:n.partyApiParams.loadMoreCurrentParty||w(t.Type)}}),Roblox.UserNotifications.subscribe("FriendshipNotifications",function(t){a.debug("--------- this is FriendshipNotifications subscription -----------"+t.Type);switch(t.Type){case u.notificationType.friendshipDestroyed:var i=t.EventArgs;angular.forEach(i,function(t){t!==n.chatLibrary.userId&&n.$digest(vt(t))}),c.triggerHandler("Roblox.Friends.CountChanged");break;case u.notificationType.friendshipCreated:b(),c.triggerHandler("Roblox.Friends.CountChanged")}}),Roblox.UserNotifications.subscribe("PresenceNotifications",function(i){a.debug("--------- this is PresenceNotifications subscription -----------"+i.Type);switch(i.Type){case u.notificationType.presenceOnline:case u.notificationType.presenceOffline:if(n.chatLibrary.friendsDict[i.UserId]){var r=n.chatLibrary.friendsDict[i.UserId];t.getUserPresence(r).then(function(t){n.chatLibrary.friendsDict[r.Id].UserPresenceType=t.UserPresenceType},function(){a.debug(" ----- getUserPresence failed -----")})}}})}};n.handleSignalRSuccess=function(){if(a.debug(" -------- Signal R is connected ------ "),n.chatLibrary.chatLayout.errorMaskEnable=!1,n.chatLibrary.chatLayout.pageInitializing){n.chatLibrary.chatLayout.pageInitializing=!1;return}lt(),nt()},n.handleSignalRError=function(){a.debug(" -------- Signal R is disconnected ------ "),n.chatLibrary.chatLayout.errorMaskEnable=!0},n.isPartyLeader=function(){return n.chatLibrary.party.isPartyLeader},n.onResize=function(){var t;if(n.chatLibrary.chatLayout.numberOfDialogs>n.chatLibrary.chatLayout.availableNumberOfDialogs)while(n.chatLibrary.dialogIdList.length>n.chatLibrary.chatLayout.availableNumberOfDialogs){if(a.debug(" -------------overflow ------ $scope.chatLibrary.dialogIdList.length ------------- "+n.chatLibrary.dialogIdList.length),t=n.chatLibrary.dialogIdList.pop(),angular.isUndefined(t))break;t&&n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.MINIMIZE)}else if(n.chatLibrary.chatLayout.numberOfDialogs<n.chatLibrary.chatLayout.availableNumberOfDialogs)while(n.chatLibrary.dialogIdList.length<n.chatLibrary.chatLayout.availableNumberOfDialogs){if(a.debug(" -------------fit ------ $scope.chatLibrary.dialogIdList.length ------------- "+n.chatLibrary.dialogIdList.length),t=n.chatLibrary.minimizedDialogIdList.pop(),angular.isUndefined(t))break;t&&n.chatLibrary.minimizedDialogData[t]&&(delete n.chatLibrary.minimizedDialogData[t],n.chatLibrary.dialogIdList.push(t),n.chatLibrary.dialogDict[t]=angular.copy(u.dialogInitValue))}n.chatLibrary.chatLayout.resizing=!1},n.toggleChatContainer=function(){if(!n.chatLibrary.inApp){var t=angular.element(document.querySelector(".wrap"));n.chatLibrary.deviceType===u.deviceType.PHONE&&(n.chatLibrary.chatLayout.collapsed?t.addClass("hidden"):t.removeClass("hidden")),n.chatLibrary.chatLayout.collapsed=!n.chatLibrary.chatLayout.collapsed,d(),n.chatLibrary.chatLayout.chatBarInitialized=!0,wt()}},n.getLayoutId=function(n,t){switch(t){case u.dialogType.FRIEND:return"friend_"+n;case u.dialogType.CHAT:case u.dialogType.GROUPCHAT:case u.dialogType.PENDINGPARTY:case u.dialogType.ADDFRIENDS:case u.dialogType.PARTY:return"conv_"+n;case u.dialogType.NEWPARTY:return u.newParty.dialogType;case u.dialogType.NEWGROUPCHAT:return u.newGroup.dialogType}},n.getUserInfoForConversation=function(i){if(i.ParticipantUsers){if(i.userIds=[],i.dialogType===n.dialogType.PARTY||i.dialogType===n.dialogType.PENDINGPARTY){var r=i.party;i.membersDict={},angular.forEach(r.MemberUsers,function(n){i.membersDict[n.Id]||(i.membersDict[n.Id]=n.Id!==r.LeaderUser.Id?{memberStatus:u.memberStatus.MEMBER,statusTooltip:u.party.partyMemberTooltip}:{memberStatus:u.memberStatus.LEADER,statusTooltip:u.party.partyLeaderTooltip})})}i.groupName="",i.ParticipantUsers.forEach(function(r){switch(i.dialogType){case n.dialogType.PENDINGPARTY:case n.dialogType.PARTY:i.membersDict[r.Id]?i.membersDict[r.Id].memberStatus===u.memberStatus.LEADER||i.userIds.length===0?i.userIds.unshift(r.Id):i.membersDict[r.Id].memberStatus===u.memberStatus.MEMBER?i.userIds.splice(1,0,r.Id):i.userIds.push(r.Id):(i.userIds.push(r.Id),i.membersDict[r.Id]={memberStatus:u.memberStatus.PENDING,statusTooltip:n.chatLibrary.party.pendingMemberTooltip}),r.Id!==n.chatLibrary.userId&&(i.groupName=i.groupName?i.groupName+", "+r.Username:r.Username),i.IsGroupChat||r.Id===n.chatLibrary.userId?i.IsGroupChat&&(i.partyName=u.newParty.partyName+i.groupName):i.partyName=u.newParty.partyName+r.Username;break;case n.dialogType.GROUPCHAT:i.userIds.push(r.Id),r.Id!==n.chatLibrary.userId&&(i.groupName=i.groupName?i.groupName+", "+r.Username:r.Username);break;case n.dialogType.CHAT:r.Id!==n.chatLibrary.userId&&(i.userIds.push(r.Id),i.displayUserId=r.Id,i.Username=r.Username);break;default:i.userIds.push(r.Id)}n.chatLibrary.friendsDict[r.Id]||t.getUserInfo(r).then(function(t){t&&r.Id===t.Id&&(n.chatLibrary.friendsDict[r.Id]=t)},function(){a.debug(" ----- getUserInfo failed -----")}),!i.IsGroupChat&&n.chatViewModel.friendsHasConversation.indexOf(r.Id)<0&&n.chatViewModel.friendsHasConversation.push(r.Id)})}},n.updateChatViewModel=function(t,i){var r,f,e;t.IsGroupChat||t.dialogType!==u.dialogType.CHAT||t.ParticipantUsers.forEach(function(i){if(i.Id!==n.chatViewModel.userId){var r=n.getLayoutId(i.Id,u.dialogType.FRIEND),f=n.chatLibrary.chatLayoutIds.indexOf(r);f>-1&&(n.chatLibrary.chatLayoutIds.splice(f,1),delete n.chatUserDict[r]),v(r,!0),n.chatLibrary.userConversationsDict[i.Id]=t.layoutId}});switch(t.dialogType){case n.dialogType.PENDINGPARTY:t.pendingPartyMsg=u.party.partyInviteMsg,t.incomingPartyInvite=!1,t.name=t.groupName;break;case n.dialogType.PARTY:ct(t.party.Id,t),t.incomingPartyInvite=!1,t.name=t.partyName;break;case n.dialogType.GROUPCHAT:t.name=t.groupName;break;case n.dialogType.CHAT:t.name=t.Username;break;default:angular.isDefined(t.Username)&&(t.name=t.Username)}n.chatUserDict[t.layoutId]=t,r=n.chatLibrary.chatLayoutIds.indexOf(t.layoutId),r>-1&&n.chatLibrary.chatLayoutIds.splice(r,1),t.isConversation&&(i?n.chatLibrary.chatLayoutIds.length>0&&t.dialogType!==u.dialogType.PARTY?(f=n.chatLibrary.chatLayoutIds[0],e=n.chatUserDict[f],e.dialogType===u.dialogType.PARTY?n.chatLibrary.chatLayoutIds.splice(1,0,t.layoutId):n.chatLibrary.chatLayoutIds.unshift(t.layoutId)):n.chatLibrary.chatLayoutIds.unshift(t.layoutId):t.dialogType&&t.dialogType===u.dialogType.PARTY?n.chatLibrary.chatLayoutIds.unshift(t.layoutId):n.chatLibrary.chatLayoutIds.push(t.layoutId)),v(t.layoutId),t.isConversation&&!n.chatLibrary.conversationsDict[t.Id]&&(n.chatLibrary.conversationsDict[t.Id]=angular.copy(u.conversationInitStatus),n.chatLibrary.conversationsDict[t.Id].layoutId=t.layoutId)},n.filterFriends=function(t){var i=[],r;t=u.sortFriendList(n.chatLibrary,t),n.chatLibrary.friendIds=[],n.chatLibrary.friendLayoutIds=[],t.forEach(function(n){yt(n)}),n.chatLibrary.chatLayoutIds.forEach(function(t){n.chatUserDict[t].isConversation&&i.push(t)}),r=i.concat(n.chatLibrary.friendLayoutIds),n.chatLibrary.chatLayoutIds=r},n.buildChatUserListByFriends=function(i,r){return n.chatApiParams.loadMoreConversations=!1,n.chatApiParams.loadMoreFriends=!0,t.getFriends(n.chatLibrary.userId,i,r)},n.buildChatUserListByUnreadConversations=function(t){t.forEach(function(t){var e=n.getLayoutId(t.Id,u.dialogType.CHAT),f;n.chatUserDict[e]?(f=n.chatUserDict[e],t.HasUnreadMessages&&t.ChatMessages&&t.ChatMessages.length>0&&(f.HasUnreadMessages=!0,n.chatLibrary.dialogDict[e]&&n.chatLibrary.dialogIdList.indexOf(e)>-1&&r.manipulateMessages(f,t.ChatMessages,n.chatLibrary.friendsDict),f.DisplayMessage=t.ChatMessages[0],n.updateChatViewModel(f,!0)),f.ParticipantUsers=t.ParticipantUsers,f.dialogType===u.dialogType.PARTY?i.getCurrentParty().then(function(t){t&&(f.party=t,n.getUserInfoForConversation(f))}):n.getUserInfoForConversation(f),p(f)):(t.layoutId=e,t.isConversation=!0,t.dialogType=t.IsGroupChat?u.dialogType.GROUPCHAT:u.dialogType.CHAT,n.getUserInfoForConversation(t),n.updateChatViewModel(t,!0),p(t))})},n.buildChatUserListByConversations=function(t,i){var r=[];t.forEach(function(t){var f=n.getLayoutId(t.Id,t.dialogType);r.push(t.Id),t.layoutId=f,t.isConversation=!0,n.getUserInfoForConversation(t),n.updateChatViewModel(t,i),t.dialogType===u.dialogType.PARTY&&t.party.LeaderUser.Id===n.chatLibrary.userId&&(n.chatLibrary.party.isPartyLeader=!0)}),pt(r)},n.cancelSearch=function(){n.chatViewModel.searchTerm="",n.chatLibrary.chatLayout.searchFocus=!1},n.launchDialog=function(i,r){n.chatLibrary.dialogIdList.indexOf(i)<0&&i===u.newGroup.layoutId?(g(i,r),n.chatUserDict[u.newGroup.layoutId]=n.newGroup):n.chatLibrary.dialogIdList.indexOf(i)<0&&n.chatUserDict[i]&&(n.chatUserDict[i].isConversation?g(i,r):t.startOneToOneConversation(n.chatUserDict[i].Id).then(function(t){var o=n.chatLibrary.chatLayoutIds.indexOf(i),f,e;n.chatLibrary.chatLayoutIds.splice(o,1),delete n.chatUserDict[i],v(i,!0),f=t.Conversation,e=n.getLayoutId(f.Id,u.dialogType.CHAT),f.layoutId=e,f.isConversation=!0,f.dialogType=u.dialogType.CHAT,f.ChatMessages=[],n.getUserInfoForConversation(f),n.updateChatViewModel(f,!0),g(e,r)},function(){a.debug(" ---- startOneToOneConversation ---- failed!")}))},n.destroyDialogLayout=function(n){angular.element(document.querySelector("#"+n)).empty()},n.closeDialog=function(t){var s=n.chatLibrary.dialogIdList.indexOf(t),h=u.getScrollBarSelector(n.chatUserDict[t]),c=angular.element(document.querySelector(h)),l=angular.element(document.querySelector("#chat-main")),e,o,i;s>-1&&(n.chatLibrary.dialogIdList.splice(s,1),delete n.chatLibrary.dialogDict[t]),n.chatUserDict[t].dialogType===u.dialogType.NEWPARTY&&(n.chatLibrary.party.isPartyExisted=!1),n.chatUserDict[t].dialogType===u.dialogType.NEWGROUPCHAT&&(n.chatUserDict[t].selectedUserIds=[],n.chatUserDict[t].selectedUsersDict={},n.chatUserDict[t].numberOfSelected=0),c.mCustomScrollbar("destroy"),n.$broadcast("Roblox.Chat.MarkDialogInactive",{layoutId:t}),e=n.chatUserDict[t].Id,n.chatLibrary.conversationsDict[e]&&n.chatLibrary.conversationsDict[e].remove?(o=n.chatLibrary.chatLayoutIds.indexOf(t),o>-1&&n.chatUserDict[t]&&(n.chatLibrary.chatLayoutIds.splice(o,1),delete n.chatUserDict[t],angular.equals(n.chatUserDict,{})&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)),v(t,!0),n.chatLibrary.party.isPartyExisted=!1):r.manipulateMessages(n.chatUserDict[t],null),n.chatLibrary.deviceType===u.deviceType.PHONE&&l.removeClass("hidden"),n.destroyDialogLayout(t),n.chatLibrary.minimizedDialogIdList.length>0&&(i=n.chatLibrary.minimizedDialogIdList.shift(),delete n.chatLibrary.minimizedDialogData[i],n.chatLibrary.dialogIdList.push(i),n.chatLibrary.dialogDict[i].isUpdated=!0,n.chatLibrary.dialogDict[i].updateStatus=u.dialogStatus.REPLACE),f.updateCookie(u.cookies.dialogIdList,n.chatLibrary.dialogIdList,n.chatLibrary.cookieOption),f.updateCookie(u.cookies.dialogDict,n.chatLibrary.dialogDict,n.chatLibrary.cookieOption)},ft(),n.$watch(function(){return n.chatViewModel},function(t,i){angular.isUndefined(t)||angular.equals(t,i)||(n.chatLibrary.chatLayout.pageInitializing=!0,n.chatLibrary.chatLayout.pageDataLoading=!0,lt(),ni(),nt(),ti())}),angular.element(h).bind("resize",function(){!n.chatLibrary.chatLayout.resizing&&n.chatLibrary.dialogIdList.length>0&&(n.chatLibrary.chatLayout.resizing=!0,st(),ot()||gt()?(a.debug(" ------- need to resize -------------- "),n.onResize()):n.chatLibrary.chatLayout.resizing=!1)}),n.$on("Roblox.Chat.destroyChatCookie",function(){f.destroyCookie(u.cookies.dialogIdList,n.chatLibrary.cookieOption),f.destroyCookie(u.cookies.dialogDict,n.chatLibrary.cookieOption),f.destroyCookie(u.cookies.dialogsLayout,n.chatLibrary.cookieOption),f.destroyCookie(u.cookies.chatBarLayout,n.chatLibrary.cookieOption),e.removeLocalStorage(n.chatLibrary.dialogLocalStorageName)}),n.$on("Roblox.Chat.LoadUnreadConversationCount",function(){d()})}]);

;// ~/viewapp/pages/chat/controllers/dialogsController.js
"use strict";chat.controller("dialogsController",["$scope","chatService","chatUtility","partyService","messageService","$window","$log",function(n,t,i,r,u,f,e){var o=function(t,r,u){var f=u,e=n.getLayoutId(t.Id,r),o;t.dialogType=r,f!==e?(n.getUserInfoForConversation(t),t.layoutId=e,t.isConversation=!0,n.updateChatViewModel(t,!0),n.chatUserDict[f].selectedUserIds=[],n.chatUserDict[f].selectedUsersDict={},delete n.chatUserDict[f],o=n.chatLibrary.dialogIdList.indexOf(f),o>-1?(n.destroyDialogLayout(u),delete n.chatLibrary.dialogDict[f],n.chatLibrary.dialogIdList[o]=e):n.chatLibrary.dialogIdList.push(e),n.chatLibrary.dialogDict[e]=angular.copy(i.dialogInitValue)):(n.getUserInfoForConversation(t),n.updateChatViewModel(t,!0),n.chatLibrary.dialogDict[f].isUpdated=!0,n.chatLibrary.dialogDict[f].updateStatus=i.dialogStatus.REFRESH)},s=function(t){var r=i.newParty.layoutId;n.chatUserDict[r]=i.newParty,n.chatUserDict[r].selectedUserIds=[],n.chatUserDict[r].selectedUserIds.push(t),n.chatLibrary.party.isPartyExisted=!0,n.sendInvite(r)};n.createParty=function(t,u){i.cleanPartyList(n.chatLibrary,n.chatUserDict,null);var f=n.chatUserDict[u].selectedUserIds,e=t.Id;n.chatUserDict[u].selectedUserIds=[],r.partyCreate(e,f).then(function(r){n.chatLibrary.party.isPartyLeader=!0,t.party=r,o(t,i.dialogType.PARTY,u)})},n.sendInvite=function(u){if(e.debug("------------- sendInvite ------------"),n.chatUserDict[u].dialogType!==i.dialogType.CHAT&&n.chatUserDict[u].dialogType!==i.dialogType.GROUPCHAT||n.chatUserDict[u].addMoreFriends)n.chatUserDict[u].addMoreFriends?t.addToConversation(n.chatUserDict[u].selectedUserIds,n.chatUserDict[u].Id).then(function(t){var f,e;t.ConversationId&&(n.chatUserDict[u].addMoreFriends=!1,f=n.chatUserDict[u],(n.chatUserDict[u].dialogType===i.dialogType.PARTY||n.chatUserDict[u].party)&&(e=f.selectedUserIds,e.forEach(function(n){r.partyInvite(f.party.Id,n)})),f.userIds=f.userIds.concat(f.selectedUserIds),f.selectedUserIds=[],f.selectedUsersDict={})},function(){e.debug(" ---- addToConversation ---- failed --- from sendInvite request------")}):n.chatUserDict[u].dialogType===i.dialogType.NEWGROUPCHAT&&t.startGroupConversation(n.chatUserDict[u].selectedUserIds).then(function(n){if(n.Success){var t=n.Conversation;o(t,i.dialogType.GROUPCHAT,u)}},function(){e.debug(" ---- startGroupConversation ---- failed --- on sending startGroupConveration request------")});else{var f=n.chatUserDict[u],s=angular.copy(f.userIds),h=s.indexOf(n.chatLibrary.userId);h>-1&&s.splice(h,1),f.selectedUserIds=s,n.createParty(f,u)}}}]);

;// ~/viewapp/pages/chat/directives/chatBarDirective.js
"use strict";chat.directive("chatBar",["chatHybridService","$log",function(n,t){return{restrict:"A",replace:!0,templateUrl:Roblox.ChatTemplates.ChatBarTemplate,link:function(i){if(Roblox.BootstrapWidgets.SetupTooltip(),i.chatLibrary.inApp){var f=n.getTopBarHeight();t.debug(" ---------- top bar height -------- "+f)}}}}]);

;// ~/viewapp/pages/chat/directives/lazyLoadDirective.js
"use strict";chat.directive("lazyLoad",["chatService","$log",function(n,t){return{restrict:"A",scope:!0,link:function(i,r){var e=angular.element(document.querySelector(".chat-friend-list")),f=function(){i.buildChatUserListByFriends(i.chatApiParams.startIndexOfFriendList,i.chatApiParams.pageSizeOfFriendList).then(function(n){i.chatLibrary.chatLayout.isChatLoading=!1,i.filterFriends(n),n.length>0?(i.chatApiParams.startIndexOfFriendList=+i.chatApiParams.startIndexOfFriendList+i.chatApiParams.pageSizeOfFriendList,e.mCustomScrollbar("update"),n.length<i.chatApiParams.pageSizeOfFriendList&&(i.chatApiParams.loadMoreFriends=!1,i.chatApiParams.startIndexOfFriendList=0)):(i.chatApiParams.loadMoreFriends=!1,i.chatApiParams.startIndexOfFriendList=0)},function(){i.chatLibrary.chatLayout.isChatLoading=!1,t.debug("---error from get Friends in lazyLoadDirective.js---")})},o=function(){if(!i.chatApiParams||!i.chatApiParams.loadMoreConversations&&!i.chatApiParams.loadMoreFriends)return!1;i.chatLibrary.chatLayout.isChatLoading=!0,i.chatApiParams.loadMoreConversations&&n.getUserConversations(i.chatApiParams.pageNumberOfConversations,i.chatApiParams.pageSizeOfConversations).then(function(n){i.chatLibrary.chatLayout.isChatLoading=!1,n&&n.length>0?(i.buildChatUserListByConversations(n),i.chatApiParams.pageNumberOfConversations++,e.mCustomScrollbar("update"),n.length<i.chatApiParams.pageSizeOfConversations&&(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,i.chatApiParams.pageNumberOfPartyInvites=1,f())):(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,f())},function(){i.chatLibrary.chatLayout.isChatLoading=!1,t.debug("---error from get Conversations in lazyLoadDirective.js---")}),i.chatApiParams.loadMoreFriends&&f()};r.mCustomScrollbar({callbacks:{onTotalScrollOffset:60,onTotalScroll:o,onOverflowYNone:o}})}}}]);

;// ~/viewapp/pages/chat/directives/dialogDirective.js
"use strict";chat.directive("dialog",["$window","$compile","$templateCache","$interval","$timeout","chatService","chatUtility","partyService","cookieService","ngAudio","localStorageService","messageService","$log",function(n,t,i,r,u,f,e,o,s,h,c,l,a){return{restrict:"A",scope:{dialogData:"=",chatLibrary:"=",closeDialog:"&",sendInvite:"&"},link:function(r,f){var ht=angular.element(document.querySelector("#chat-main")),v=angular.copy(e.dialogLayout.limitMemberDisplay),k=null,p=0,w=function(){r.dialogData.party?(r.dialogData.isPartyExisted=!0,r.dialogData.partyInGame=r.dialogData.party.GamePlaceId?!0:!1):(r.dialogData.isPartyExisted=!1,r.dialogData.partyInGame=!1)},d=function(){r.isOverLoaded(),r.dialogData.currentUserId=r.currentUserId;switch(r.dialogData.dialogType){case e.dialogType.CHAT:var n;angular.forEach(r.dialogData.userIds,function(t){t!==r.chatLibrary.userId&&(n=t)}),r.dialogLayout.title=r.chatLibrary.friendsDict[n]?r.chatLibrary.friendsDict[n].Username:r.dialogData.Username,r.dialogLayout.templateUrl=Roblox.ChatTemplates.DialogTemplate,r.dialogData.name=r.chatLibrary.friendsDict[n]?r.chatLibrary.friendsDict[n].Username:r.dialogData.Username,r.dialogData.nameLink=r.chatLibrary.friendsDict[n].UserProfileLink,w();break;case e.dialogType.PENDINGPARTY:r.dialogLayout.templateUrl=r.dialogData.IsGroupChat?Roblox.ChatTemplates.GroupDialogTemplate:Roblox.ChatTemplates.DialogTemplate,r.dialogLayout.limitMemberDisplay=v/2,r.dialogData.name=r.dialogData.groupName,w();break;case e.dialogType.GROUPCHAT:r.dialogLayout.templateUrl=Roblox.ChatTemplates.GroupDialogTemplate,r.dialogLayout.limitMemberDisplay=r.dialogData.party?v/2:v,r.dialogData.name=r.dialogData.groupName,w();break;case e.dialogType.PARTY:r.dialogData.partyName=r.dialogData.partyName?r.dialogData.partyName:e.party.partyName,r.dialogLayout.templateUrl=r.dialogData.IsGroupChat?Roblox.ChatTemplates.GroupDialogTemplate:Roblox.ChatTemplates.DialogTemplate,r.dialogLayout.limitMemberDisplay=r.dialogData.party.LeaderUser.Id===r.chatLibrary.userId?v/2:v,r.dialogData.party.GamePlaceId&&!r.dialogData.placeThumbnail&&o.getPlace(r.dialogData.party.GamePlaceId).then(function(n){r.dialogData.placeThumbnail=n}),r.dialogData.name=r.dialogData.partyName,w();break;case e.dialogType.NEWGROUPCHAT:r.dialogLayout.title=r.dialogData.title,r.dialogLayout.templateUrl=Roblox.ChatTemplates.NewGroupTemplate,r.dialogData.name=r.dialogData.title;break;case e.dialogType.NEWPARTY:r.dialogLayout.title=r.dialogData.title,r.dialogLayout.templateUrl=Roblox.ChatTemplates.NewGroupTemplate}},st=function(){(r.dialogLayout.IsdialogContainerVisible||f.find(".dialog-container"))&&(r.dialogLayout.IsdialogContainerVisible=!1,f.empty());var n=angular.element(i.get(r.dialogLayout.templateUrl)),u=t(n);f.append(n),u(r)},ot=function(t){var o=r.dialogData.layoutId,a="#"+o,i=r.chatLibrary.chatLayout,u=angular.element(document.querySelector(a)).find(".dialog-container"),v=i.widthOfChat,s=i.widthOfDialog+i.spaceOfDialog,y=t.indexOf(o),f,h,c,l;r.chatLibrary.deviceType===e.deviceType.PHONE?u.addClass("dialog-visible"):(f=+v+y*s+i.spaceOfDialog,h=n.innerWidth,h<f+s?(c=+i.defaultChatZIndex+1,u.css("z-index",c)):u.css("right",f),u.addClass("dialog-visible")),r.chatLibrary.deviceType===e.deviceType.PHONE&&ht.addClass("hidden"),l=function(){r.$digest(r.toggleDialogFocusStatus(!0))};u.on("click touchstart",l)},ut=function(){r.chatLibrary.inApp||(s.updateCookie(e.cookies.dialogIdList,r.chatLibrary.dialogIdList,r.chatLibrary.cookieOption),s.updateCookie(e.cookies.dialogDict,r.chatLibrary.dialogDict,r.chatLibrary.cookieOption))},ft=function(){r.chatLibrary.inApp||(r.chatLibrary.dialogsLayout[r.dialogData.layoutId]=r.dialogLayout,s.updateCookie(e.cookies.dialogsLayout,r.chatLibrary.dialogsLayout,r.chatLibrary.cookieOption))},nt=function(n){var t=angular.isDefined(r.dialogData.userIds)?r.dialogData.userIds.indexOf(n):-1,i=angular.isDefined(r.dialogData.selectedUserIds)?r.dialogData.selectedUserIds.indexOf(n):-1;return t<0&&i<0},y=function(){r.dialogLibrary=c.getLocalStorage(r.chatLibrary.dialogLocalStorageName)?c.getLocalStorage(r.chatLibrary.dialogLocalStorageName):{}},ct=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&r.dialogLibrary[r.dialogData.layoutId].active},rt=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&!r.dialogLibrary[r.dialogData.layoutId].active},g=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&r.dialogLibrary[r.dialogData.layoutId].played},it=Math.floor(Math.random()*100+1),tt=1500+it,b,et=function(){b=u(function(){y(),r.dialogLibrary&&!r.dialogLibrary[r.dialogData.layoutId].played?(r.chatLibrary.audio.play(),r.dialogLibrary[r.dialogData.layoutId].played=!0,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary)):u.cancel(b)},tt)},lt=function(){r.chatLibrary.inApp&&(r.dialogLayout.focusMeEnabled=!1)};r.dialogData.friendIds=angular.copy(r.chatLibrary.friendIds),r.dialogMessages=[],r.dialogType=angular.copy(e.dialogType),r.deviceType=angular.copy(e.deviceType),r.memberStatus=angular.copy(e.memberStatus),r.dialogLayout=angular.isDefined(r.chatLibrary.dialogsLayout[r.dialogData.layoutId])?r.chatLibrary.dialogsLayout[r.dialogData.layoutId]:angular.copy(e.dialogLayout),r.updateFriends=function(n){var t=[],i,u;n?(u=e.sortFriendList(r.chatLibrary,n),u.forEach(function(n){nt(n.Id)&&t.push(n.Id),r.chatLibrary.friendsDict[n.Id]||(r.chatLibrary.friendsDict[n.Id]=n)}),r.dialogData.friendIds=t):(i=angular.copy(r.chatLibrary.friendIds),angular.forEach(i,function(n){nt(n)&&t.push(n)}),r.dialogData.friendIds=t)},r.isOverLoaded=function(){angular.isUndefined(r.dialogData.selectedUserIds)&&(r.dialogData.selectedUserIds=[],r.dialogData.selectedUsersDict={}),r.dialogData.dialogType!==e.dialogType.FRIEND&&(r.dialogData.numberOfSelected=r.dialogData.dialogType===e.dialogType.NEWGROUPCHAT?r.dialogData.selectedUserIds.length:r.dialogData.userIds.length+r.dialogData.selectedUserIds.length-1,r.dialogLayout.isMembersOverloaded=r.dialogData.numberOfSelected>=r.chatLibrary.quotaOfPartyMembers?!0:!1)},r.dialogData.selectedUserIds=[],r.dialogData.selectedUsersDict={},r.selectFriends=function(n){var t=r.dialogData.selectedUserIds.indexOf(n);t<0&&!r.dialogLayout.isMembersOverloaded?(r.dialogData.selectedUserIds.push(n),r.dialogData.selectedUsersDict[n]=r.chatLibrary.friendsDict[n]):t>-1&&(r.dialogData.selectedUserIds.splice(t,1),delete r.dialogData.selectedUsersDict[n]),r.dialogData.searchTerm="",r.isOverLoaded()},r.toggleDialogContainer=function(){r.chatLibrary.deviceType!==e.deviceType.PHONE&&(r.dialogLayout.collapsed=!r.dialogLayout.collapsed),r.chatLibrary.deviceType===e.deviceType.COMPUTER&&ft()},r.toggleDialogFocusStatus=function(n){r.dialogLayout.hasFocus=n,n&&r.dialogLayout.active&&r.markInactive(),n?(r.dialogLayout.focusMeEnabled=!r.chatLibrary.inApp,l.markMessagesAsRead(r.dialogData)):r.dialogLayout.focusMeEnabled=!1},r.getTitle=function(n){var u,t,i,f;r.dialogData.dialogType===e.dialogType.PENDINGPARTY&&n===e.activeType.PARTYINVITE?(t=r.dialogData.party?r.dialogData.party.CreatorUser.Name:r.dialogData.InitiatorUser.Username,u=e.chatLayout.defaultTitleForPartyInvite+t):(i=r.dialogData.ChatMessages,i&&i.length>0?(f=i[0].SenderUserId,t=r.chatLibrary.friendsDict[f].Username):t=r.dialogData.InitiatorUser.Username,u=t+e.chatLayout.defaultTitleForMessage),r.title=u},r.changeTitle=function(){n.document.title=p%2==0?r.title:r.chatLibrary.currentTabTitle,p++},r.markInactive=function(){r.dialogLayout.active&&(r.dialogLayout.active=!1,clearInterval(k),p=0,n.document.title=r.chatLibrary.currentTabTitle,y(),ct()&&(a.debug(" --------------- markInactive -------------- set into local storage"),angular.isUndefined(r.dialogLibrary[r.dialogData.layoutId])&&(r.dialogLibrary[r.dialogData.layoutId]={}),r.dialogLibrary[r.dialogData.layoutId].active=!1,r.dialogLibrary[r.dialogData.layoutId].played=!1,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary)))},r.markActive=function(n){y(),angular.isUndefined(r.dialogLibrary[r.dialogData.layoutId])&&(r.dialogLibrary[r.dialogData.layoutId]={}),r.dialogLibrary[r.dialogData.layoutId].active=!0,r.dialogLibrary[r.dialogData.layoutId].played=!1,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary),r.dialogLayout.hasFocus||(clearInterval(k),p=0,y(),g()||et(),r.getTitle(n),k=setInterval(r.changeTitle,r.chatLibrary.intervalOfChangeTitleForPartyChrome)),r.dialogLayout.active=!0,r.dialogLayout.focusMeEnabled&&(r.dialogLayout.focusMeEnabled=!1)},r.handleLocalStorage=function(n){n.key===r.chatLibrary.dialogLocalStorageName&&(y(),r.dialogLayout.active&&rt()&&r.markInactive(),g()&&u.cancel(b))},lt(),r.isOverLoaded(),r.$watch(function(){return r.chatLibrary.dialogDict},function(n,t){if(angular.isDefined(n)&&angular.isDefined(n[r.dialogData.layoutId])){var u=r.dialogData.layoutId,o=r.chatLibrary,s=o.dialogIdList.indexOf(u),i=n[u],h=t[u];if(!h||i.isUpdated){i.isUpdated=!1;switch(i.updateStatus){case e.dialogStatus.INIT:case e.dialogStatus.REPLACE:s>-1&&(r.dialogLayout.focusMeEnabled===i.autoOpen&&(r.dialogLayout.focusMeEnabled=!i.autoOpen,i.autoOpen||l.markMessagesAsRead(r.dialogData)),d(),st(),Roblox.BootstrapWidgets.SetupTooltip(),Roblox.BootstrapWidgets.SetupPopover());break;case e.dialogStatus.MINIMIZE:d(),r.chatLibrary.minimizedDialogIdList.indexOf(u)<0&&(r.chatLibrary.minimizedDialogIdList.push(u),r.chatLibrary.minimizedDialogData[u]=r.dialogData),f.empty();break;case e.dialogStatus.REFRESH:d(),i.updateStatus=e.dialogStatus.INIT}}r.chatLibrary.deviceType!==e.deviceType.PHONE&&ut(),s>-1&&(ot(o.dialogIdList),i.markAsActive&&(r.markActive(i.activeType),i.markAsActive=!1))}},!0),r.$on("Roblox.Chat.MarkDialogInactive",function(n,t){t.layoutId===r.dialogData.layoutId&&r.markInactive()}),c.listenLocalStorage(r.handleLocalStorage)}}}]);

;// ~/viewapp/pages/chat/directives/groupSelectDirective.js
"use strict";chat.directive("groupSelect",["$log",function(){return{restrict:"A",link:function(n,t){var r=40;n.$watch(function(){return t.innerHeight()},function(t,i){if(t&&t!==i){var f="#"+n.dialogData.layoutId+" .dialog-container",e="#"+n.dialogData.layoutId+" "+n.friendsScrollbarElm,o=angular.element(f),u=angular.element(e),s=o.height(),h=s-r-t;u.css("height",h),u.mCustomScrollbar("update")}},!0)}}}]);

;// ~/viewapp/pages/chat/directives/abuseReportDirective.js
"use strict";chat.directive("abuseReport",function(){return{restrict:"A",templateUrl:Roblox.ChatTemplates.AbuseReportTemplate,link:function(){}}});

;// ~/viewapp/pages/chat/directives/friendsSelectionDirective.js
"use strict";chat.directive("friendsSelection",["chatUtility",function(n){return{restrict:"A",templateUrl:Roblox.ChatTemplates.FriendsSelectionTemplate,link:function(t){var u=function(){if(angular.isUndefined(t.dialogData)||angular.isUndefined(t.dialogData.selectedUserIds))return!1;t.dialogLayout.inviteBtnDisabled=t.dialogData.dialogType===n.dialogType.NEWGROUPCHAT?t.dialogData.selectedUserIds.length<2:t.dialogData.selectedUserIds.length===0};u(),t.$watch(function(){return t.dialogData.selectedUserIds},function(){u()},!0)}}}]);

;// ~/viewapp/pages/chat/controllers/dialogController.js
"use strict";chat.controller("dialogController",["$scope","chatService","chatUtility","partyService","messageService","$window","$log",function(n,t,i,r,u,f,e){var s=angular.element(document.querySelector("#chat-data-model")),h=function(i,r){t.removeFromConversation(n.chatLibrary.userId,i).then(function(){n.closeDialog(r)},function(){e.debug("---------- removeFromConversation request failed------- ")})},c=function(){n.chatLibrary.party.isPartyExisted=!1,r.partyLeave(n.dialogData.party.Id).then(function(){i.removeParty(n.chatLibrary,n.dialogData)},function(){e.debug("---------- partyLeave request failed------- ")})},l=function(i){t.sendMessage(n.dialogData.Id,i.RawContent).then(function(t){i.sendingMessage=!1,t.ResultType!==0?(i.sendMessageHasError=!0,i.error=t.StatusMessage):(angular.isUndefined(n.dialogData.messagesDict)&&(n.dialogData.messagesDict={}),i.Id=t.MessageId,n.dialogData.messagesDict[t.MessageId]=i)},function(){e.debug(" ------ sendMessage error -------"),i.sendingMessage=!1,i.sendMessageHasError=!0})},o=function(){t.getFriends(n.chatLibrary.userId,n.dialogParams.startIndexOfFriendList,n.dialogParams.pageSizeOfFriendList).then(function(t){t&&t.length<=n.dialogParams.pageSizeOfFriendList?(n.updateFriends(t),n.dialogData.scrollBarType=i.scrollBarType.FRIENDSELECTION,i.buildScrollbar(n.friendsScrollbarElm),t.length===n.dialogParams.pageSizeOfFriendList&&(n.dialogParams.loadMoreFriends=!0,n.dialogParams.startIndexOfFriendList=+n.dialogParams.startIndexOfFriendList+n.dialogParams.pageSizeOfFriendList,o())):n.dialogParams.loadMoreFriends=!1})};n.dialogParams=angular.copy(i.dialogParams),n.dialogLayout.numberOfPartyMembers=s.data("numberofmembersforpartychrome"),n.userPresenceTypes=i.userPresenceTypes,n.dialogData.messageForSend="",n.scrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.MESSAGE),n.friendsScrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.FRIENDSELECTION),n.focusDialog=function(){n.dialogLayout.active=!1},n.updateDialog=function(){if(e.debug("---- updateDialog callback ---- Scrollbars updated"),!n.dialogLayout.IsdialogContainerVisible){var t=angular.element(document.querySelector(n.scrollbarElm));t.find(".mCustomScrollBox").addClass("dialog-visible"),n.dialogLayout.IsdialogContainerVisible=!0}return!1},n.sendMessage=function(){if(n.dialogData.messageForSend.length>0){var r=i.htmlEntities(n.dialogData.messageForSend),t={Read:!0,Content:i.linkify(r),RawContent:n.dialogData.messageForSend,SenderUserId:n.chatLibrary.userId,sendingMessage:!0,sendMessageHasError:!1};n.dialogData.messageForSend="",angular.isUndefined(n.dialogData.ChatMessages)&&(n.dialogData.ChatMessages=[]),n.dialogData.ChatMessages.unshift(t),n.dialogData.DisplayMessage=t,l(t)}},n.abuseReport=function(t,i){n.dialogLayout.isConfirmationOn=!0,t&&(n.dialogData.userIdForAbuseReport=t),i&&n.dialogData.userIdForAbuseReport&&(window.location.href="/abusereport/chatv2?id="+n.dialogData.userIdForAbuseReport+"&redirectUrl="+escape(window.location)+"&conversationId="+n.dialogData.Id,n.dialogData.userIdForAbuseReport=null,n.dialogLayout.isConfirmationOn=!1)},n.leaveGroup=function(){if(n.dialogData.dialogType===i.dialogType.PARTY)c();else if(n.dialogData.dialogType===i.dialogType.PENDINGPARTY){var t=n.dialogData.party.Id;r.removeFromParty(t,n.chatLibrary.userId)}(n.dialogData.dialogType===i.dialogType.GROUPCHAT||n.dialogData.dialogType===i.dialogType.PENDINGPARTY)&&(n.chatLibrary.conversationsDict[n.dialogData.Id].remove=!0,h(n.dialogData.Id,n.dialogData.layoutId))},n.addFriends=function(){n.dialogData.addMoreFriends=!0,n.chatLibrary.friendIds.length>0&&n.updateFriends(),o()},n.viewParticipants=function(){n.dialogLayout.lookUpMembers=!n.dialogLayout.lookUpMembers},n.removeMember=function(u){if(n.dialogData.dialogType===i.dialogType.PARTY){var f=n.dialogData.party.Id;r.removeFromParty(f,u)}t.removeFromConversation(u,n.dialogData.Id).then(function(){n.isOverLoaded()},function(){e.debug("---------- removeMember request failed------- ")})},n.joinParty=function(){r.partyJoin(n.dialogData.party.Id).then(function(t){t.Success&&(n.chatLibrary.partyIds.push(n.dialogData.party.Id),n.chatLibrary.partiesDict[n.dialogData.party.Id]={conversationId:n.dialogData.Id,layoutId:n.dialogData.layoutId},n.dialogData.dialogType=i.dialogType.PARTY)},function(){e.debug("-------------partyAcceptInvite request failed -------------")})},n.joinGame=function(){r.joinGame(n.dialogData,n.chatLibrary.inApp)},n.linkToProfile=function(n){n.stopPropagation()},t.getMessages(n.dialogData.Id,null,n.dialogParams.pageSizeOfGetMessages).then(function(t){t.length>0?(n.dialogData.ChatMessages=[],n.dialogData.messagesDict={},u.manipulateMessages(n.dialogData,t,n.chatLibrary.friendsDict),n.dialogData.scrollBarType=i.scrollBarType.MESSAGE,i.buildScrollbar(n.scrollbarElm)):(n.dialogData.scrollBarType=i.scrollBarType.MESSAGE,i.buildScrollbar(n.scrollbarElm),n.updateDialog())},function(){e.debug("---------- getMessages request failed------- ")}),n.$on("elastic:resize",function(t,r,u,f){if(e.debug("---- oldHeight -----"+u+"---- newHeight -----"+f),u!==f){var o=angular.element(document.querySelector(n.scrollbarElm)),s=angular.element(r.parent());f>u?(o.addClass("dialog-body-resize"),s.addClass("dialog-input-resize")):f<=i.dialogLayout.heightOfInput&&(o.removeClass("dialog-body-resize"),s.removeClass("dialog-input-resize")),o.mCustomScrollbar("update")}})}]);

;// ~/viewapp/pages/chat/directives/dialogLazyLoadDirective.js
"use strict";chat.directive("dialogLazyLoad",["chatService","chatUtility","messageService","$log",function(n,t,i,r){return{restrict:"A",scope:!0,link:function(t,u){var e=function(){if(!t.dialogParams.loadMoreMessages||!t.dialogLayout.IsdialogContainerVisible)return!1;t.dialogLayout.isChatLoading=!0;var u=t.dialogData.ChatMessages.length;n.getMessages(t.dialogData.Id,t.dialogData.ChatMessages[u-1].Id,t.dialogParams.pageSizeOfGetMessages).then(function(n){t.dialogLayout.isChatLoading=!1,n?(n.length>0&&(t.dialogLayout.scrollToBottom=!1,t.dialogData.ChatMessages=t.dialogData.ChatMessages.concat(n)),n.length<t.dialogParams.pageSizeOfGetMessages&&(t.dialogParams.loadMoreMessages=!1)):(t.dialogParams.loadMoreMessages=!1,i.manipulateMessages(t.dialogData,n,t.chatLibrary.friendsDict))},function(){t.dialogLayout.isChatLoading=!1,r.debug("---error from get getMessages in dialogLazyLoadDirective.js---")})},o=function(){r.debug("---- onInit callback ---- Scrollbars updated"),t.dialogLayout.scrollToBottom=!0};u.mCustomScrollbar({callbacks:{onInit:o,onUpdate:function(){r.debug("---- onUpdate callback ---- Scrollbars updated"),t.dialogLayout.scrollToBottom?(u.mCustomScrollbar("update"),u.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})):t.dialogLayout.scrollToBottom=!0,u.hasClass("mCS_no_scrollbar")&&t.updateDialog()},onTotalScroll:t.updateDialog,onTotalScrollOffset:20,onTotalScrollBack:e}})}}}]);

;// ~/viewapp/pages/chat/directives/dialogMinimizeDirective.js
"use strict";chat.directive("dialogMinimize",["$window","$compile","$templateCache","chatService","chatUtility","$log",function(n,t,i,r,u,f){return{restrict:"A",scope:{chatLibrary:"="},templateUrl:Roblox.ChatTemplates.DialogMinimizeTemplate,link:function(n,t){var r=function(){var i=n.chatLibrary.chatLayout,r=n.chatLibrary.dialogIdList.length,u=i.widthOfChat,f=i.widthOfDialog+i.spaceOfDialog,e=+u+r*f+i.spaceOfDialog;t.css("right",e)};n.dialogType=u.dialogType,n.hasMinimizedDialogs=!1,n.layoutIdHasClicked=!1,n.openDialog=function(t){var i,r;f.debug(" -------------------openDialog------------------ "+t),i=n.chatLibrary.dialogIdList.pop(),n.chatLibrary.dialogDict[i].isUpdated=!0,n.chatLibrary.dialogDict[i].updateStatus=u.dialogStatus.MINIMIZE,n.chatLibrary.dialogIdList.push(t),n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.REPLACE,r=n.chatLibrary.minimizedDialogIdList.indexOf(t),r>-1&&(n.chatLibrary.minimizedDialogIdList.splice(r,1),delete n.chatLibrary.minimizedDialogData[t])},n.remove=function(t){var i=n.chatLibrary.minimizedDialogIdList.indexOf(t);i>-1&&(n.chatLibrary.minimizedDialogIdList.splice(i,1),delete n.chatLibrary.minimizedDialogData[t],delete n.chatLibrary.dialogDict[t])},Roblox.BootstrapWidgets.SetupPopover("top",{selector:"#dialogs-minimize"}),n.$watch(function(){return n.chatLibrary.minimizedDialogIdList},function(t,i){angular.isUndefined(t)||t==i||(f.debug("------ watch minimizedDialogIdList ----- "),t.length>0?(n.hasMinimizedDialogs||(n.hasMinimizedDialogs=!0),r()):t.length===0&&(n.hasMinimizedDialogs=!1))},!0)}}}]);

;// ~/viewapp/pages/chat/directives/minimizeItemDirective.js
"use strict";chat.directive("minimizeItem",["$log",function(){return{restrict:"A",scope:!0,link:function(n){var u=function(){n.$apply(n.openDialog(n.dialogLayoutId))},r;angular.element("#dialogs-minimize").on("click touchstart",".popover-content #"+n.dialogLayoutId+" .minimize-title",u);r=function(){n.$apply(n.remove(n.dialogLayoutId))};angular.element("#dialogs-minimize").on("click touchstart",".popover-content #"+n.dialogLayoutId+" .minimize-close",r)}}}]);

;// ~/viewapp/pages/chat/directives/chatSettingDirective.js
"use strict";chat.directive("chatSetting",["chatService","partyService","$log",function(){return{restrict:"A",scope:!0,link:function(n,t){var o=function(){n.$digest(n.addFriends())},r,u,f,e;t.on("click touchstart","#add-friends",o);r=function(){n.$digest(n.viewParticipants())};t.on("click touchstart","#view-participants",r);u=function(){n.$digest(n.leaveGroup())};t.on("click touchstart","#leave-group",u);if(f=function(t){var i=t.data;n.$digest(n.abuseReport(i.userId,i.isConfirmed))},n.dialogData&&!n.dialogData.IsGroupChat){angular.forEach(n.dialogData.userIds,function(t){t!==n.chatLibrary.userId&&(e=t)});t.on("click touchstart","#abuse-report",{userId:e,isConfirmed:!1},f)}}}}]);

;// ~/viewapp/pages/chat/controllers/friendsController.js
"use strict";chat.controller("friendsController",["$scope","chatService","chatUtility","$log",function(n,t,i){n.dialogLayout.scrollToBottom=!1,n.dialogLayout.IsdialogContainerVisible=!1,n.dialogParams=angular.copy(i.dialogParams),n.dialogType=angular.copy(i.dialogType),n.userPresenceTypes=angular.copy(i.userPresenceTypes),n.friendsScrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.FRIENDSELECTION),n.dialogData.scrollBarType=i.scrollBarType.FRIENDSELECTION,n.dialogData.isCreated=!0;var u=function(){t.getFriends(n.chatLibrary.userId,n.dialogParams.startIndexOfFriendList,n.dialogParams.pageSizeOfFriendList).then(function(t){t?(n.updateFriends(t),i.buildScrollbar(n.friendsScrollbarElm),t.length===n.dialogParams.pageSizeOfFriendList&&(n.dialogParams.loadMoreFriends=!0,n.dialogParams.startIndexOfFriendList=+n.dialogParams.startIndexOfFriendList+n.dialogParams.pageSizeOfFriendList,u())):(n.dialogParams.loadMoreFriends=!1,n.dialogParams.startIndexOfFriendList=0)})};n.chatLibrary.friendIds.length>0&&(n.updateFriends(),i.buildScrollbar(n.friendsScrollbarElm)),u(),n.isOverLoaded()}]);

;// ~/viewapp/pages/chat/directives/friendsLazyLoadDirective.js
"use strict";chat.directive("friendsLazyLoad",["chatService","$log",function(n){return{restrict:"A",scope:!0,link:function(t,i){var u=function(){if(!t.dialogParams.loadMoreFriends)return!1;t.dialogLayout.isChatLoading=!0,n.getFriends(t.chatLibrary.userId,t.dialogParams.startIndexOfFriendList,t.dialogParams.pageSizeOfFriendList).then(function(n){t.dialogLayout.isChatLoading=!1,t.updateFriends(n),n.length<t.dialogParams.pageSizeOfFriendList?t.dialogParams.loadMoreFriends=!1:t.dialogParams.startIndexOfFriendList=+t.dialogParams.startIndexOfFriendList+t.dialogParams.pageSizeOfFriendList,i.mCustomScrollbar("update")},function(){t.dialogLayout.isChatLoading=!1})};i.mCustomScrollbar({callbacks:{onTotalScroll:u,onOverflowYNone:u}})}}}]);
